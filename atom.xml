<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>wangzhipeng404</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2018-06-21T04:07:09.407Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>wangzhipeng404</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>hexo首页开启阅读原文</title>
    <link href="http://yoursite.com/2018/06/21/hexo%E9%A6%96%E9%A1%B5%E5%BC%80%E5%90%AF%E9%98%85%E8%AF%BB%E5%8E%9F%E6%96%87/"/>
    <id>http://yoursite.com/2018/06/21/hexo首页开启阅读原文/</id>
    <published>2018-06-21T03:08:49.000Z</published>
    <updated>2018-06-21T04:07:09.407Z</updated>
    
    <content type="html"><![CDATA[<p>时隔两年，终于在闲下来的时候记起来写点东西，但当我绞尽脑汁把上一篇文章写完发布之后，却发现之前设置的样式变掉了，首页直接展示了内容的全文，这样阅读体验非常差，作为一个处女座的强迫症患者，这完全不能忍。 <a id="more"></a><br>google了一下，发现网上大多数的文章都说只要在文章里面添加 <code>&lt;!-- more --&gt;</code> 就行了，hexo会自动截取 <code>&lt;!--more--&gt;</code> 之前的内容作为摘要，我看了一下我之前的文章，发现我原来是有添加的，但现在却并没有发挥作用。这些教程并没有给我解决问题。<br>不过在看过几篇文章之后，其中一篇有提到需要在 <code>&lt;!-- more --&gt;</code> 前后有空格才会正确匹配。像这样：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">escape</span>&gt;</span><span class="comment">&lt;!-- more --&gt;</span><span class="tag">&lt;<span class="name">escape</span>&gt;</span></span><br></pre></td></tr></table></figure><p>修改了一下刷新本地服务，发现的确是有了。但如果这样就成功了，那我也就不用写这篇文章了。因为当我重新生成静态文件再部署到gitpage时，并没有看到阅读全文的效果。<br>再次google了一下 <code>hexo &lt;!-- more --&gt;</code> 在hexo的issue下发现还是挺多人遇到这个问题的，问题里面有人提到是因为hexo-renderer-markdown-it插件在生成html的时候  <code>&lt;!-- more --&gt;</code> 里面的尖括号转义了，变成了 <code>&amp;lgt;!-- more --&amp;lgt;</code> ,而hexo的正则匹配的应该是 <code>&lt;!-- more--&gt;</code>  ,所以才会失效。查看了一下生成的首页，发现果然如此。<br>既然定位到了hexo-renderer-markdown-it是问题的根源，那就好办了，查看了一下hexo-renderer-markdown-it的文档，发现在高级配置中有关于是否允许包含html标签的配置。所以修改一下blog的_config.yml中的markdown配置，添加render项：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">markdown:</span></span><br><span class="line"><span class="attr">  render:</span></span><br><span class="line"><span class="attr">    html:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    xhtmlOut:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    breaks:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    linkify:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    typographer:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    quotes:</span> <span class="string">'“”‘’'</span></span><br></pre></td></tr></table></figure><p>再重新生成一次静态文件，发现index.html里面已经是正常的阅读全文了,效果见首页。</p><p>顺便提一下，gitpage是有设置缓存的，所以更新之后发现效果还没有变，可以在链接上面加上一个参数强制刷新本地缓存。</p><p>再顺顺便提一下，hexo是全局替换<code>&lt;!-- more--&gt;</code>的，为了让这篇文章的<code>&lt;!-- more --&gt;</code>能正确显示，也让我折腾了一会…</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;时隔两年，终于在闲下来的时候记起来写点东西，但当我绞尽脑汁把上一篇文章写完发布之后，却发现之前设置的样式变掉了，首页直接展示了内容的全文，这样阅读体验非常差，作为一个处女座的强迫症患者，这完全不能忍。&lt;/p&gt;
    
    </summary>
    
      <category term="基层建设" scheme="http://yoursite.com/categories/%E5%9F%BA%E5%B1%82%E5%BB%BA%E8%AE%BE/"/>
    
    
      <category term="hexo" scheme="http://yoursite.com/tags/hexo/"/>
    
      <category term="基建" scheme="http://yoursite.com/tags/%E5%9F%BA%E5%BB%BA/"/>
    
  </entry>
  
  <entry>
    <title>AntdPro页内多活动页面模式设计，兼容单页面</title>
    <link href="http://yoursite.com/2018/06/20/AntdPro%E9%A1%B5%E5%86%85%E5%A4%9A%E6%B4%BB%E5%8A%A8%E9%A1%B5%E9%9D%A2%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1%EF%BC%8C%E5%85%BC%E5%AE%B9%E5%8D%95%E9%A1%B5%E9%9D%A2/"/>
    <id>http://yoursite.com/2018/06/20/AntdPro页内多活动页面模式设计，兼容单页面/</id>
    <published>2018-06-20T07:24:38.000Z</published>
    <updated>2018-06-21T02:20:52.131Z</updated>
    
    <content type="html"><![CDATA[<h1>0x00 预料之外的需求</h1><p>最近三个月都在用Antd Pro对公司整套后台系统进行重构以满足新功能的需求，经过这段时间的埋头苦干，项目也终于正常上线投入使用，正当我想着终于可以缓一缓的时候。同事却反馈回来说，有些时候使用着很蛋疼，比如列表跳转到详情再跳转回来就不能保存原来的搜索状态了，希望能够多开几个页面。 <a id="more"></a> 听到这个需求的时候我内心是崩溃的，前期需求根本没有考虑到这个问题，难道我得加班加点将几十上百个页面重新调整里满足这个需求，光想想就够累了。而且在重构之前，这个问题是可以通过浏览器多开tab解决的，而现在是单页，多开tab的话不能共享store的数据，那单页还有什么意义。</p><h1>0x01 分析一下</h1><p>既然不能在浏览器多开tab，那么只能在页面内解决了，其实在使用antd pro重构之前，也考虑过使用vue方案，而iview也提供过一个admin框架,它有一个功能是在顶部导航显示打开过的页面并切换回去。既然别人实现过了，我就没必要重复造轮子吧，正当我开心的把iview-admin的demo跑起来准备看它如何实现的时候，我发现它仅仅只是添加了一个tag，点击可以切换路由回页面，但是最终组件还是重新加载了，那跟现在也没有什么很大区别，只能另寻方案。<br>虽然在使用antd pro构建了整个项目，对react全家桶也算挺熟悉了，但却并没有仔仔细细的去看过antd pro的一些实现。所以只能从头开始把整个框架的思路理清一遍。发现其实整个框架做的事情很简单，先是rotuer判断是否登录来决定渲染login还是baseLayout，登录之后baseLayout里面router根据当前path渲染活动组件。既然这样，那我只要在baseLayout里面监听路由的变化，每当路由变化就新开一个tab不就解决了么。而这个不就跟浏览器新建窗口一样么。</p><h1>0x02 browserLayout</h1><p>有了思路之后一切就好办了，每层 router 都会给子组件注入 location，match 和 history，只要调用history.listen()方法就能监控着路由的变化了，我们使用一个数组将每个path存起来，然后使用antd的tab渲染出来，不就获得一个完全由页内的控制的浏览器了么，所以我将这种布局方式叫做browserLayout。代码逻辑还是挺简单的。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">componentDidMount () &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; history &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">  history.listen(<span class="function"><span class="params">location</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; pathname &#125; = location;</span><br><span class="line">    <span class="comment">// 如果是根目录，就覆盖为index</span></span><br><span class="line">    <span class="keyword">const</span> path = pathname === <span class="string">'/'</span> ? <span class="string">'/index'</span> : pathname;</span><br><span class="line">    <span class="comment">// 为了方便后续关闭tab，我将tab list保存在store的user下面</span></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">user</span>: &#123; tabList, activeTab, locations &#125;, dispatch &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="comment">//如果path不在list中，就添加进去</span></span><br><span class="line">    <span class="keyword">if</span> (tabList.indexOf(path) === <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> newList = [...tabList];</span><br><span class="line">      <span class="keyword">const</span> index = newList.indexOf(activeTab);</span><br><span class="line">      newList.splice(index + <span class="number">1</span>, <span class="number">0</span>, path);</span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        type: <span class="string">'user/savehistory'</span>,</span><br><span class="line">        payload: &#123;</span><br><span class="line">          tabList: newList, <span class="comment">// 打开的tab</span></span><br><span class="line">          activeTab: path, <span class="comment">// 当前激活tab</span></span><br><span class="line">          locations: &#123; <span class="comment">// 当前的router详情</span></span><br><span class="line">            ...locations,</span><br><span class="line">            [path]: &#123; ...location &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 如果path已经打开，就切换到相应tab并更新router详情</span></span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        type: <span class="string">'user/savehistory'</span>,</span><br><span class="line">        payload: &#123;</span><br><span class="line">          activeTab: path,</span><br><span class="line">          locations: &#123;</span><br><span class="line">            ...locations,</span><br><span class="line">            [path]: &#123; ...location &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 涉及到权限和重定向，并且把router注入的props重新注入进去</span></span><br><span class="line">getComponent = <span class="function"><span class="params">path</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> cpath = path;</span><br><span class="line">    <span class="keyword">const</span> &#123; routerData, <span class="attr">user</span>: &#123; locations &#125; &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> urlParams = <span class="keyword">new</span> URL(<span class="built_in">window</span>.location.href);</span><br><span class="line">    <span class="keyword">const</span> redirect = urlParams.searchParams.get(<span class="string">'redirect'</span>);</span><br><span class="line">    <span class="keyword">if</span> (redirect) &#123;</span><br><span class="line">      cpath = redirect;</span><br><span class="line">      urlParams.searchParams.delete(<span class="string">'redirect'</span>);</span><br><span class="line">      <span class="built_in">window</span>.history.replaceState(<span class="literal">null</span>, <span class="string">'redirect'</span>, urlParams.href);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (routerData[cpath]) &#123;</span><br><span class="line">      <span class="keyword">if</span> (check(routerData[cpath].authority, cpath)) &#123;</span><br><span class="line">        <span class="keyword">const</span> InnerComponent = routerData[cpath].component;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          &lt;TabPane</span><br><span class="line">            tab=&#123;routerData[cpath].name&#125;</span><br><span class="line">            style=&#123;&#123; <span class="attr">padding</span>: <span class="string">'24px 24px'</span> &#125;&#125;</span><br><span class="line">            key=&#123;cpath&#125;</span><br><span class="line">            closable=&#123;cpath !== <span class="string">'/index'</span>&#125;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;InnerComponent location=&#123;locations[cpath]&#125; /&gt;</span><br><span class="line">          &lt;<span class="regexp">/TabPane&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">      &#125; else &#123;</span></span><br><span class="line"><span class="regexp">        const InnerComponent = NotPermission;</span></span><br><span class="line"><span class="regexp">        return (</span></span><br><span class="line"><span class="regexp">          &lt;TabPane</span></span><br><span class="line"><span class="regexp">            tab="403"</span></span><br><span class="line"><span class="regexp">            key=&#123;cpath&#125;</span></span><br><span class="line"><span class="regexp">            style=&#123;&#123; padding: '24px 24px' &#125;&#125;</span></span><br><span class="line"><span class="regexp">            closable=&#123;cpath !== '/i</span>ndex<span class="string">'&#125;</span></span><br><span class="line"><span class="string">          &gt;</span></span><br><span class="line"><span class="string">            &lt;InnerComponent /&gt;</span></span><br><span class="line"><span class="string">          &lt;/TabPane&gt;</span></span><br><span class="line"><span class="string">        );</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125; else &#123;</span></span><br><span class="line"><span class="string">      const InnerComponent = NotFound;</span></span><br><span class="line"><span class="string">      return (</span></span><br><span class="line"><span class="string">        &lt;TabPane</span></span><br><span class="line"><span class="string">          tab="404"</span></span><br><span class="line"><span class="string">          style=&#123;&#123; padding: '</span><span class="number">24</span>px <span class="number">24</span>px<span class="string">' &#125;&#125;</span></span><br><span class="line"><span class="string">          key=&#123;cpath&#125;</span></span><br><span class="line"><span class="string">          closable=&#123;cpath !== '</span>/index<span class="string">'&#125;</span></span><br><span class="line"><span class="string">        &gt;</span></span><br><span class="line"><span class="string">          &lt;InnerComponent /&gt;</span></span><br><span class="line"><span class="string">        &lt;/TabPane&gt;</span></span><br><span class="line"><span class="string">      );</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;;</span></span><br><span class="line"><span class="string">  // 切换tab</span></span><br><span class="line"><span class="string">  handleChangeTab = path =&gt; &#123;</span></span><br><span class="line"><span class="string">    const &#123; dispatch, user: &#123; locations &#125; &#125; = this.props;</span></span><br><span class="line"><span class="string">    dispatch(&#123;</span></span><br><span class="line"><span class="string">      type: '</span>user/savehistory<span class="string">',</span></span><br><span class="line"><span class="string">      payload: &#123;</span></span><br><span class="line"><span class="string">        activeTab: path,</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">    dispatch(routerRedux.push(locations[path]));</span></span><br><span class="line"><span class="string">  &#125;;</span></span><br><span class="line"><span class="string">  // 关闭tab</span></span><br><span class="line"><span class="string">  handleCloseTab = path =&gt; &#123;</span></span><br><span class="line"><span class="string">    const &#123; user: &#123; tabList, locations &#125;, dispatch &#125; = this.props;</span></span><br><span class="line"><span class="string">    const index = tabList.indexOf(path);</span></span><br><span class="line"><span class="string">    dispatch(&#123;</span></span><br><span class="line"><span class="string">      type: '</span>user/closeTab<span class="string">',</span></span><br><span class="line"><span class="string">      payload: &#123;</span></span><br><span class="line"><span class="string">        path,</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      callback: () =&gt; &#123;</span></span><br><span class="line"><span class="string">        dispatch(routerRedux.push(locations[tabList[index - 1]]));</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &#125;;</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">render () &#123;</span></span><br><span class="line"><span class="string">  &lt;Content style=&#123;&#123; margin: '</span><span class="number">8</span>px <span class="number">12</span>px <span class="number">0</span><span class="string">', height: '</span><span class="number">100</span>%<span class="string">' &#125;&#125;&gt;</span></span><br><span class="line"><span class="string">    &lt;Tabs</span></span><br><span class="line"><span class="string">      type="editable-card"</span></span><br><span class="line"><span class="string">      activeKey=&#123;this.props.user.activeTab&#125;</span></span><br><span class="line"><span class="string">      onChange=&#123;this.handleChangeTab&#125;</span></span><br><span class="line"><span class="string">      onEdit=&#123;this.handleCLoseTab&#125;</span></span><br><span class="line"><span class="string">      hideAdd</span></span><br><span class="line"><span class="string">    &gt;</span></span><br><span class="line"><span class="string">      &#123;this.props.user.tabList.map(path =&gt; this.getComponent(path))&#125;</span></span><br><span class="line"><span class="string">    &lt;/Tabs&gt;</span></span><br><span class="line"><span class="string">  &lt;/Content&gt;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h1>0x03 一个新的问题</h1><p>当我行云流水的写完上面的逻辑，一次性跑通之后，正当我认为完成了的时候，我突然发现，当我以进入不同id的详情的时候，却页面内容却并没有更新。这下解决了一个问题，却引入另一个问题，页面后退数据记录不保持，也只是增加了麻烦，但是数据不更新，可是一个很严重的问题。<br>理了理思路，原来是因为页面内容都是在componentDidMount时从后台获取的，而页面加载之后，就不会在执行componentDidMount了，所以不会更新。google了一下如何强制重载react，都只提到在componentWillReceiveProps时作更新，但这样需要在所有组件里面添加判断逻辑去重新获取数据，完全不符合我的懒人风格。<br>忽然在结果中看到一篇对react key的解析文章，react在diif时如果key属性不一样时会直接放弃比较重新渲染整个组件，这不就是我想要的吗。所以修改一下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;InnerComponent location=&#123;locations[cpath]&#125; key=&#123;cpath + locations[cpath].search&#125; /&gt;</span><br></pre></td></tr></table></figure><p>大功告成。</p><h1>0x04 后续优化</h1><ul><li>问题1：由于key是fullpath,虽然可以满足大部分情况，但是还是有一些页面是完全不依赖路由上的参数只从store上获取数据的，所以在需要强制更新的时候只能在路由上附带一个时间戳来触发强制更新。</li><li>问题2：当添加一个新的产品之后，需要更新列表页，但又希望保留列表的搜索表单数据，所以只能触发列表页的loaddata()而不能直接重新加载组件，所以问题1的方法并不适用，只能在store里面存一个freshtime,在需要触发更新的时候修改freshtime，而页内通过componentWillReceiveProps判断freshtime是否变化来调用loaddata就行了。</li></ul><h1>0x05 优势互补</h1><p>其实至此问题基本上已经解决了，但是同时开启多tab的情况下，对于页面的性能影响还是挺大的，虽然在一些情况下需要多tab才能满足需求，但是大部分时间，我们只需要原版单活动页就够了。所以我在头部加了一个布局切换按钮，然后加了一个控制层。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'dva'</span>;</span><br><span class="line"><span class="keyword">import</span> BasicLayout <span class="keyword">from</span> <span class="string">'./BasicLayout'</span>;</span><br><span class="line"><span class="keyword">import</span> BrowserLayout <span class="keyword">from</span> <span class="string">'./BrowserLayout'</span>;</span><br><span class="line"></span><br><span class="line">@connect(<span class="function">(<span class="params">&#123; user &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  layout: user.basicLayout,</span><br><span class="line">&#125;))</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">SwitchLayout</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; layout &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> layout ? &lt;BasicLayout &#123;...this.props&#125; /&gt; : &lt;BrowserLayout &#123;...this.props&#125; /&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样就两种布局可以按需切换了。</p>]]></content>
    
    <summary type="html">
    
      &lt;h1&gt;0x00 预料之外的需求&lt;/h1&gt;
&lt;p&gt;最近三个月都在用Antd Pro对公司整套后台系统进行重构以满足新功能的需求，经过这段时间的埋头苦干，项目也终于正常上线投入使用，正当我想着终于可以缓一缓的时候。同事却反馈回来说，有些时候使用着很蛋疼，比如列表跳转到详情再跳转回来就不能保存原来的搜索状态了，希望能够多开几个页面。&lt;/p&gt;
    
    </summary>
    
      <category term="react" scheme="http://yoursite.com/categories/react/"/>
    
    
      <category term="react" scheme="http://yoursite.com/tags/react/"/>
    
      <category term="antd pro" scheme="http://yoursite.com/tags/antd-pro/"/>
    
  </entry>
  
  <entry>
    <title>vue入门——优化记事本，改成手机单页应用</title>
    <link href="http://yoursite.com/2016/07/15/vue%E5%85%A5%E9%97%A8%E2%80%94%E2%80%94v-show%E5%85%83%E7%B4%A0%E5%88%87%E6%8D%A2%E5%B1%95%E7%A4%BA/"/>
    <id>http://yoursite.com/2016/07/15/vue入门——v-show元素切换展示/</id>
    <published>2016-07-15T08:08:28.000Z</published>
    <updated>2018-06-21T02:22:24.693Z</updated>
    
    <content type="html"><![CDATA[<p>昨天完成的记事本，只能说是功能上完成而已，样式和使用都不能使人满意，而且日历和编辑框还有展示都同时出现，这样的排版完全不能自适应手机，而且对与模板内v-if太多也令人非常不满意，所以今天就将其优化一下，改成一个能适应手机端的单页应用。 <a id="more"></a></p><h1>class与style的绑定</h1><p>昨天为了快速完成这个应用，便没有再从头看一遍vue的教程，导致我在处理日历的样式显示上使用了很多v\—if来做判断，导致代码冗余，一点也不优雅，而且v-if对性能的开销也比较大，原来的写法：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"is_same_day(day)"</span> <span class="attr">class</span>=<span class="string">"cell-dom current-date"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">"$index &lt; month_arr.preLen || $index &gt;= month_arr.preLen + month_arr.currentLen"</span> <span class="attr">class</span>=<span class="string">"disable"</span>&gt;</span></span><br><span class="line">    &#123;&#123;day.getDate()&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">    &#123;&#123;day.getDate()&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span> <span class="attr">class</span>=<span class="string">"cell-dom"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">"$index &lt; month_arr.preLen || $index &gt;= month_arr.preLen + month_arr.currentLen"</span> <span class="attr">class</span>=<span class="string">"disable"</span>&gt;</span></span><br><span class="line">    &#123;&#123;day.getDate()&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">    &#123;&#123;day.getDate()&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>一堆的if，代码冗余太多了，重新查看了一遍教程，发现vue控制class的语法是v-bind:class,可以控制元素的class，改写之后：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell-dom"</span> <span class="attr">v-bind:class</span>=<span class="string">"&#123;</span></span></span><br><span class="line"><span class="tag"><span class="string">  'current-date': is_same_day(day),</span></span></span><br><span class="line"><span class="tag"><span class="string">  'disable': $index &lt; month_arr.preLen || $index &gt;= month_arr.preLen + month_arr.currentLen,</span></span></span><br><span class="line"><span class="tag"><span class="string">  'has-note': has_note(day)</span></span></span><br><span class="line"><span class="tag"><span class="string">  &#125;</span></span></span><br><span class="line"><span class="tag"><span class="string">  "</span>&gt;</span></span><br><span class="line">  &#123;&#123;day.getDate()&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>添加了一个是否有笔记的样式展示，如果有笔记日期的数字显示为红色，所以写了一个判断方法：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">has_note: <span class="function"><span class="keyword">function</span> (<span class="params">date</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> id = <span class="keyword">this</span>.create_id(date)</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.notes[id]) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>这样的写法优雅多了。</p><h1>v-show实现元素的切换展示</h1><p>由于手机屏幕比较小，所以不能将三个元素同时展示出来，我便希望能够点击日期，页面变为展示当天笔记，在笔记页面可以返回日历，点击编辑，便可展示编辑框和保存按钮这样一个单页应用，v-if和v-show都可以实现，但是教程里面说推荐使用v-show,性能开销比较小。修改完之后的效果：<br>日历界面<br><img src="/2016/07/15/vue入门——v-show元素切换展示/calendar.jpg" alt="vue_noebook"><br>内容展示界面<br><img src="/2016/07/15/vue入门——v-show元素切换展示/note.jpg" alt="vue_noebook"><br>编辑界面<br><img src="/2016/07/15/vue入门——v-show元素切换展示/edit.jpg" alt="vue_noebook"><br>完整的组件代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"calendar-wrap"</span> <span class="attr">v-show</span>=<span class="string">"show === 'calendar'"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"calendar-header"</span>&gt;</span></span><br><span class="line">        &lt;span class="pre-month" v-on:click="pre_month"&gt;&lt;&lt;/span&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;current_year&#125;&#125;年&#123;&#123;current_month + 1&#125;&#125;月<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"next-month"</span> <span class="attr">v-on:click</span>=<span class="string">"next_month"</span>&gt;</span>&gt;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"calendar-body clearfix"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">"item in week"</span> <span class="attr">class</span>=<span class="string">"cell-dom"</span>&gt;</span></span><br><span class="line">          &#123;&#123;item&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">"day in month_arr.date"</span> <span class="attr">class</span>=<span class="string">""</span> <span class="attr">v-on:click</span>=<span class="string">"update_date(day)"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell-dom"</span> <span class="attr">v-bind:class</span>=<span class="string">"&#123;</span></span></span><br><span class="line"><span class="tag"><span class="string">            'current-date': is_same_day(day),</span></span></span><br><span class="line"><span class="tag"><span class="string">            'disable': $index &lt; month_arr.preLen || $index &gt;= month_arr.preLen + month_arr.currentLen,</span></span></span><br><span class="line"><span class="tag"><span class="string">            'has-note': has_note(day)</span></span></span><br><span class="line"><span class="tag"><span class="string">            &#125;</span></span></span><br><span class="line"><span class="tag"><span class="string">            "</span>&gt;</span></span><br><span class="line">            &#123;&#123;day.getDate()&#125;&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span> &gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"note-wrap"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"note-input"</span> <span class="attr">v-show</span>=<span class="string">"show === 'edit'"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"clearfix header-nav"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"btn edit-cancel pull-left"</span> <span class="attr">v-on:click</span>=<span class="string">"show_note()"</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"btn edit-sure pull-right"</span> <span class="attr">v-on:click</span>=<span class="string">"save_note()"</span>&gt;</span>保存<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"clearfix"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"clearfix"</span>&gt;</span><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">v-model</span>=<span class="string">"current_note"</span> &gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"note-content"</span> <span class="attr">v-show</span>=<span class="string">"show === 'note'"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"header-nav"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"btn back-btn pull-left"</span> <span class="attr">v-on:click</span>=<span class="string">"show_calendar()"</span>&gt;</span>返回<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"btn edit-btn pull-right"</span> <span class="attr">v-on:click</span>=<span class="string">"show_edit()"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"clearfix"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;current_note ? current_note : '无'&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> storage = <span class="built_in">window</span>.localStorage</span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> noteStorage = storage.getItem(<span class="string">'notes'</span>) ? <span class="built_in">JSON</span>.parse(storage.getItem(<span class="string">'notes'</span>)) : &#123;&#125;</span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> monthPanel = <span class="function"><span class="keyword">function</span> (<span class="params">date</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> myDate = date || <span class="keyword">new</span> <span class="built_in">Date</span>()</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> year = myDate.getFullYear()</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> month = myDate.getMonth()</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> currentDays = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month + <span class="number">1</span>, <span class="number">0</span>).getDate()</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> preDays = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month, <span class="number">0</span>).getDate()</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> firstDay = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month, <span class="number">1</span>)</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> firstCell = firstDay.getDay() === <span class="number">0</span> ? <span class="number">6</span> : firstDay.getDay() - <span class="number">1</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> bottomCell = <span class="number">42</span> - currentDays - firstCell</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> preMonth = []</span></span><br><span class="line"><span class="javascript">  <span class="keyword">for</span> (<span class="keyword">var</span> p = firstCell; p &gt; <span class="number">0</span>; p--) &#123;</span></span><br><span class="line"><span class="javascript">    preMonth.push(<span class="keyword">new</span> <span class="built_in">Date</span>(year, month - <span class="number">1</span>, preDays - p + <span class="number">1</span>))</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> len = preMonth.length</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> currentMonth = []</span></span><br><span class="line"><span class="javascript">  <span class="keyword">for</span> (<span class="keyword">var</span> c = <span class="number">0</span>; c &lt; currentDays; c++) &#123;</span></span><br><span class="line"><span class="javascript">    currentMonth.push(<span class="keyword">new</span> <span class="built_in">Date</span>(year, month, c + <span class="number">1</span>))</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> nextMonth = []</span></span><br><span class="line"><span class="javascript">  <span class="keyword">for</span> (<span class="keyword">var</span> n = <span class="number">0</span>; n &lt; bottomCell; n++) &#123;</span></span><br><span class="line"><span class="javascript">    nextMonth.push(<span class="keyword">new</span> <span class="built_in">Date</span>(year, month + <span class="number">1</span>, n + <span class="number">1</span>))</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">  preMonth = preMonth.concat(currentMonth, nextMonth)</span></span><br><span class="line"><span class="javascript">  <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="undefined">    date: preMonth,</span></span><br><span class="line"><span class="undefined">    preLen: len,</span></span><br><span class="line"><span class="undefined">    currentLen: currentMonth.length</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> createId = <span class="function"><span class="keyword">function</span> (<span class="params">date</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> y = date.getFullYear()</span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> m = date.getMonth() + <span class="number">1</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> d = date.getDate()</span></span><br><span class="line"><span class="javascript">  m = m &lt; <span class="number">10</span> ? <span class="string">'0'</span> + m : m</span></span><br><span class="line"><span class="javascript">  d = d &lt; <span class="number">10</span> ? <span class="string">'0'</span> + d : d</span></span><br><span class="line"><span class="javascript">  <span class="keyword">return</span> <span class="string">'date'</span> + y + m + d</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> today = <span class="keyword">new</span> <span class="built_in">Date</span>()</span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> currentYear = today.getFullYear()</span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> currentMoth = today.getMonth()</span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> currentId = createId(today)</span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> currentNote = noteStorage[currentId] ? noteStorage[currentId] : <span class="string">''</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="undefined">  data () &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="undefined">      current_year: currentYear,</span></span><br><span class="line"><span class="undefined">      current_month: currentMoth,</span></span><br><span class="line"><span class="javascript">      week: [<span class="string">'一'</span>, <span class="string">'二'</span>, <span class="string">'三'</span>, <span class="string">'四'</span>, <span class="string">'五'</span>, <span class="string">'六'</span>, <span class="string">'日'</span>],</span></span><br><span class="line"><span class="undefined">      month_arr: monthPanel(today),</span></span><br><span class="line"><span class="undefined">      notes: noteStorage,</span></span><br><span class="line"><span class="undefined">      current_date: today,</span></span><br><span class="line"><span class="undefined">      current_id: currentId,</span></span><br><span class="line"><span class="undefined">      current_note: currentNote,</span></span><br><span class="line"><span class="javascript">      show: <span class="string">'calendar'</span></span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  methods: &#123;</span></span><br><span class="line"><span class="undefined">    create_id: createId,</span></span><br><span class="line"><span class="javascript">    update_month: <span class="function"><span class="keyword">function</span> (<span class="params">date</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.month_arr = monthPanel(date)</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="javascript">    update_date: <span class="function"><span class="keyword">function</span> (<span class="params">date</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> id = <span class="keyword">this</span>.create_id(date)</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.current_date = date</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.current_note = <span class="keyword">this</span>.notes[id]</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.show = <span class="string">'note'</span></span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="javascript">    update_note: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> id = <span class="keyword">this</span>.create_id(<span class="keyword">this</span>.current_date)</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.notes[id] = <span class="keyword">this</span>.current_note</span></span><br><span class="line"><span class="javascript">      storage.setItem(<span class="string">'notes'</span>, <span class="built_in">JSON</span>.stringify(<span class="keyword">this</span>.notes))</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="javascript">    next_month: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.current_month)</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (<span class="keyword">this</span>.current_month === <span class="number">12</span>) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.current_year += <span class="number">1</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.current_month = <span class="number">0</span></span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.current_month += <span class="number">1</span></span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.update_month(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="keyword">this</span>.current_year, <span class="keyword">this</span>.current_month, <span class="number">1</span>))</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="javascript">    pre_month: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (<span class="keyword">this</span>.current_month === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.current_year -= <span class="number">1</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.current_month = <span class="number">11</span></span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.current_month -= <span class="number">1</span></span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.update_month(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="keyword">this</span>.current_year, <span class="keyword">this</span>.current_month, <span class="number">1</span>))</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="javascript">    is_same_day: <span class="function"><span class="keyword">function</span> (<span class="params">date</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> date.toDateString() === <span class="keyword">this</span>.current_date.toDateString()</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="javascript">    has_note: <span class="function"><span class="keyword">function</span> (<span class="params">date</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> id = <span class="keyword">this</span>.create_id(date)</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (<span class="keyword">this</span>.notes[id]) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="literal">false</span></span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="javascript">    show_calendar: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.show = <span class="string">'calendar'</span></span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="javascript">    show_edit: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.show = <span class="string">'edit'</span></span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="javascript">    show_note: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.show = <span class="string">'note'</span></span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="javascript">    save_note: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> id = <span class="keyword">this</span>.create_id(<span class="keyword">this</span>.current_date)</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.notes[id] = <span class="keyword">this</span>.current_note</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.show_note()</span></span><br><span class="line"><span class="javascript">      storage.setItem(<span class="string">'notes'</span>, <span class="built_in">JSON</span>.stringify(<span class="keyword">this</span>.notes))</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Add "scoped" attribute to limit CSS to this component only --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">.pull-left &#123;</span></span><br><span class="line"><span class="undefined">  float: left;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">.pull-right &#123;</span></span><br><span class="line"><span class="undefined">  float: right;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">.clearfix &#123;</span></span><br><span class="line"><span class="undefined">  clear: both;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">.clearfix::befor,</span></span><br><span class="line"><span class="undefined">.clearfix::after &#123;</span></span><br><span class="line"><span class="undefined">  content:".";</span></span><br><span class="line"><span class="undefined">  display:block;</span></span><br><span class="line"><span class="undefined">  height:0;</span></span><br><span class="line"><span class="undefined">  clear:both;</span></span><br><span class="line"><span class="undefined">  visibility:hidden</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">.current-date &#123;</span></span><br><span class="line"><span class="undefined">  background-color: #42b983;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">.disable &#123;</span></span><br><span class="line"><span class="undefined">  color: #BFBFBF;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">.has-note &#123;</span></span><br><span class="line"><span class="undefined">  color: red;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">.container &#123;</span></span><br><span class="line"><span class="undefined">  display: border-box;</span></span><br><span class="line"><span class="undefined">  width: 100%;</span></span><br><span class="line"><span class="undefined">  max-width: 500px;</span></span><br><span class="line"><span class="undefined">  margin-left: auto;</span></span><br><span class="line"><span class="undefined">  margin-right: auto;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">#calendar-wrap &#123;</span></span><br><span class="line"><span class="undefined">  width: 100%;</span></span><br><span class="line"><span class="undefined">  height: 80%;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">#note-wrap &#123;</span></span><br><span class="line"><span class="undefined">  width: 100%;</span></span><br><span class="line"><span class="undefined">  height: 100%;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">.btn &#123;</span></span><br><span class="line"><span class="undefined">  border: 1px solid #ccc;</span></span><br><span class="line"><span class="undefined">  border-radius: 3px;</span></span><br><span class="line"><span class="undefined">  padding: 5px 15px;</span></span><br><span class="line"><span class="undefined">  color: #333;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">.header-nav &#123;</span></span><br><span class="line"><span class="undefined">  padding:5px 0;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">.calendar-header &#123;</span></span><br><span class="line"><span class="undefined">  font-size: 20px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">.pre-month, .next-month &#123;</span></span><br><span class="line"><span class="undefined">  padding: 10px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">.cell-dom &#123;</span></span><br><span class="line"><span class="undefined">  width: 14%;</span></span><br><span class="line"><span class="undefined">  float: left;</span></span><br><span class="line"><span class="undefined">  padding:15px 0;</span></span><br><span class="line"><span class="undefined">  border-bottom: 1px solid #ccc;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">#note-wrap .note-input, #note-wrap .note-content &#123;</span></span><br><span class="line"><span class="undefined">  width: 100%;</span></span><br><span class="line"><span class="undefined">  height: 100%;</span></span><br><span class="line"><span class="undefined">  display: block;</span></span><br><span class="line"><span class="undefined">  text-align: left;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">.note-input textarea &#123;</span></span><br><span class="line"><span class="undefined">  width: 100%;</span></span><br><span class="line"><span class="undefined">  min-height: 450px;</span></span><br><span class="line"><span class="undefined">  margin: 0;</span></span><br><span class="line"><span class="undefined">  padding: 0;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>完整的项目代码可以访问<a href="https://github.com/wangzhipeng404/calendar" target="_blank" rel="noopener">我的github</a> 查看</p><h1>总结</h1><p>还是的好好把基础教程过一遍，然后再追求更深入的东西。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;昨天完成的记事本，只能说是功能上完成而已，样式和使用都不能使人满意，而且日历和编辑框还有展示都同时出现，这样的排版完全不能自适应手机，而且对与模板内v-if太多也令人非常不满意，所以今天就将其优化一下，改成一个能适应手机端的单页应用。&lt;/p&gt;
    
    </summary>
    
      <category term="前端知识" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/"/>
    
    
      <category term="vuejs" scheme="http://yoursite.com/tags/vuejs/"/>
    
      <category term="javascript" scheme="http://yoursite.com/tags/javascript/"/>
    
      <category term="前端知识" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/"/>
    
      <category term="单页应用" scheme="http://yoursite.com/tags/%E5%8D%95%E9%A1%B5%E5%BA%94%E7%94%A8/"/>
    
      <category term="记事本" scheme="http://yoursite.com/tags/%E8%AE%B0%E4%BA%8B%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>vue入门——一个简易的记事本应用</title>
    <link href="http://yoursite.com/2016/07/14/vue%E5%85%A5%E9%97%A8-%E4%B8%80%E4%B8%AA%E7%AE%80%E6%98%93%E7%9A%84%E8%AE%B0%E4%BA%8B%E6%9C%AC%E5%BA%94%E7%94%A8/"/>
    <id>http://yoursite.com/2016/07/14/vue入门-一个简易的记事本应用/</id>
    <published>2016-07-14T07:45:10.000Z</published>
    <updated>2018-06-21T02:22:46.171Z</updated>
    
    <content type="html"><![CDATA[<p>早在vue刚出来的时候，就基本上已经把入门教程看过一遍了，但是一直没有想到合适的项目来练习，所以一直就搁置了。直前两天做日历插件的时候，在阅读日历插件源码的时候发现其原理是将所有要展示的日期计算出来存入数组，然后再根据数组生成元素添加到页面去，瞬间就想到了vue的双向数据绑定，所以决定在做完日历插件之后，便用该日历插件来做一个简易的单页应用，作为vue的入门练习。 <a id="more"></a></p><h1>初始化vue应用结构</h1><p>本来以为要自己配置webpack，但是看了一下vue教程，官方已经提供了命令行工具，可以快速构建单页应用，虽然有点庞大，但是为了图方便，就不自己写配置了，直接开命令行按教程运行：</p><blockquote><p># 全局安装 vue-cli<br>$ npm install -g vue-cli<br># 创建一个基于 “webpack” 模板的新项目<br>$ vue init webpack my-project<br># 安装依赖，走你<br>$ cd my-project<br>$ npm install<br>$ npm run dev</p></blockquote><p>这些命令跑完之后，打开localhost:8080可以看到一个helloword页面，说明初始化没什么问题。查看了一下项目文件，主要需要修改的是app.vue和hello.vue两个组件，为了省事，我决定直接在hello.vue上进行开发。完成后样子如图：<br><img src="/2016/07/14/vue入门-一个简易的记事本应用/vue_notebook.png" alt="vue_noebook"><br>完整的组件代码在文章最后，完整的应用源码可以访问 <a href="https://github.com/wangzhipeng404/calendar" target="_blank" rel="noopener">我的github</a> 查看</p><h1>确认需求</h1><p>在开始动手之前，最重要的是想清楚要做什么。在之前学习vue的教程的时候，印象比较深的是它的数据绑定和表单控件绑定，还有事件绑定，所以我决定在应用中使用这些功能，鉴于现在已经有一个日历插件了，然后表单绑定需要一个输入框，和一些事件监听，所以我决定做一个记事本应用，每点击一个日期，可以展示和编辑该日期的一些内容，并保存在localstorage中。</p><h1>构建日历</h1><p>首先是要将原来的日历插件用vue构建出来，这一部分主要是构建一个month_arr数组，用于存放当前要展示的日历面板的所以日期，然后用v-for绑定到页面中。所以首先得在data里添加month_arr字段,但由于初始数据也需要经过计算得到，所以在这之前定义了一个计算的函数：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> monthPanel = <span class="function"><span class="keyword">function</span> (<span class="params">date</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> myDate = date || <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">  <span class="keyword">var</span> year = myDate.getFullYear()</span><br><span class="line">  <span class="keyword">var</span> month = myDate.getMonth()</span><br><span class="line">  <span class="keyword">var</span> currentDays = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month + <span class="number">1</span>, <span class="number">0</span>).getDate()</span><br><span class="line">  <span class="keyword">var</span> preDays = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month, <span class="number">0</span>).getDate()</span><br><span class="line">  <span class="keyword">var</span> firstDay = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month, <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">var</span> firstCell = firstDay.getDay() === <span class="number">0</span> ? <span class="number">6</span> : firstDay.getDay() - <span class="number">1</span></span><br><span class="line">  <span class="keyword">var</span> bottomCell = <span class="number">42</span> - currentDays - firstCell</span><br><span class="line">  <span class="keyword">var</span> preMonth = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> p = firstCell; p &gt; <span class="number">0</span>; p--) &#123;</span><br><span class="line">    preMonth.push(<span class="keyword">new</span> <span class="built_in">Date</span>(year, month - <span class="number">1</span>, preDays - p + <span class="number">1</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> len = preMonth.length</span><br><span class="line">  <span class="keyword">var</span> currentMonth = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> c = <span class="number">0</span>; c &lt; currentDays; c++) &#123;</span><br><span class="line">    currentMonth.push(<span class="keyword">new</span> <span class="built_in">Date</span>(year, month, c + <span class="number">1</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> nextMonth = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> n = <span class="number">0</span>; n &lt; bottomCell; n++) &#123;</span><br><span class="line">    nextMonth.push(<span class="keyword">new</span> <span class="built_in">Date</span>(year, month + <span class="number">1</span>, n + <span class="number">1</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  preMonth = preMonth.concat(currentMonth, nextMonth)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    date: preMonth,</span><br><span class="line">    preLen: len,</span><br><span class="line">    currentLen: currentMonth.length</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> today = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line"><span class="keyword">let</span> currentYear = today.getFullYear()</span><br><span class="line"><span class="keyword">let</span> currentMoth = today.getMonth()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    data () &#123;</span><br><span class="line">      current_year: currentYear,</span><br><span class="line">      current_month: currentMoth,</span><br><span class="line">      week: [<span class="string">'一'</span>, <span class="string">'二'</span>, <span class="string">'三'</span>, <span class="string">'四'</span>, <span class="string">'五'</span>, <span class="string">'六'</span>, <span class="string">'日'</span>],</span><br><span class="line">      month_arr: monthPanel(today),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后将日历数据绑定到页面上</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"calendar-wrap"</span>&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"calendar-header"</span>&gt;</span><br><span class="line">    &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"pre-month"</span> v-on:click=<span class="string">"pre_month"</span>&gt;<span class="xml"><span class="tag">&lt;&lt;/<span class="attr">span</span>&gt;</span></span></span><br><span class="line">    &lt;span&gt;&#123;&#123;current_year&#125;&#125;年&#123;&#123;current_month + <span class="number">1</span>&#125;&#125;月&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    &lt;span class="next-month" v-on:click="next_month"&gt;&gt;&lt;/</span>span&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div class="calendar-body clearfix"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div v-for="item in week" class="cell-dom"&gt;</span></span><br><span class="line"><span class="regexp">      &#123;&#123;item&#125;&#125;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div &gt;</span><br><span class="line">    &lt;div v-<span class="keyword">for</span>=<span class="string">"day in month_arr.date"</span>  v-on:click=<span class="string">"update_date(day)"</span>&gt;</span><br><span class="line">      &lt;div v-<span class="keyword">if</span>=<span class="string">"is_same_day(day)"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"cell-dom current-date"</span>&gt;</span><br><span class="line">        &lt;span v-<span class="keyword">if</span>=<span class="string">"$index &lt; month_arr.preLen || $index &gt;= month_arr.preLen + month_arr.currentLen"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"disable"</span>&gt;</span><br><span class="line">          &#123;&#123;day.getDate()&#125;&#125;</span><br><span class="line">        &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;span v-else&gt;</span></span><br><span class="line"><span class="regexp">          &#123;&#123;day.getDate()&#125;&#125;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>span&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div v-else class="cell-dom"&gt;</span></span><br><span class="line"><span class="regexp">        &lt;span v-if="$index &lt; month_arr.preLen || $index &gt;= month_arr.preLen + month_arr.currentLen" class="disable"&gt;</span></span><br><span class="line"><span class="regexp">          &#123;&#123;day.getDate()&#125;&#125;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>span&gt;</span><br><span class="line">        &lt;span v-<span class="keyword">else</span>&gt;</span><br><span class="line">          &#123;&#123;day.getDate()&#125;&#125;</span><br><span class="line">        &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div &gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure><p>还做了一下不是本意的日期进行置灰，当前定位日期添加了背景，其中大量使用了v-if是因为我没有仔细去了解filter，用filter应该能更优雅吧，后续好好研究一下，添加了上一个月和下一个月的按钮，并使用v-on来绑定事件，同时也对每个日期添加了点击事件，但没有讲事件代理到父级，后续优化的时候试试怎么代理，在methods中添加了对应的方法。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    update_month: <span class="function"><span class="keyword">function</span> (<span class="params">date</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.month_arr = monthPanel(date)</span><br><span class="line">    &#125;,</span><br><span class="line">    update_date: <span class="function"><span class="keyword">function</span> (<span class="params">date</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> id = <span class="keyword">this</span>.create_id(date)</span><br><span class="line">      <span class="keyword">this</span>.current_date = date</span><br><span class="line">      <span class="keyword">this</span>.current_note = <span class="keyword">this</span>.notes[id]</span><br><span class="line">    &#125;,</span><br><span class="line">    next_month: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.current_month)</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.current_month === <span class="number">12</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.current_year += <span class="number">1</span></span><br><span class="line">        <span class="keyword">this</span>.current_month = <span class="number">0</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.current_month += <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.update_month(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="keyword">this</span>.current_year, <span class="keyword">this</span>.current_month, <span class="number">1</span>))</span><br><span class="line">    &#125;,</span><br><span class="line">    pre_month: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.current_month === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.current_year -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">this</span>.current_month = <span class="number">11</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.current_month -= <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.update_month(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="keyword">this</span>.current_year, <span class="keyword">this</span>.current_month, <span class="number">1</span>))</span><br><span class="line">    &#125;,</span><br><span class="line">    is_same_day: <span class="function"><span class="keyword">function</span> (<span class="params">date</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> date.toDateString() === <span class="keyword">this</span>.current_date.toDateString()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>构建输入框和内容展示区域，并进行数据绑定</h1><p>数据的储存结构继续按照之前的日期生成唯一id来进行存取，所以首先得将id的生成函数搬过来。由于使用的是localstorage，所以首先要检查是否已经有note数据，如果没有就初始化一个空的对象，当天如果已经有数据了，还必须展示出来，具体实现如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> storage = <span class="built_in">window</span>.localStorage</span><br><span class="line"><span class="keyword">let</span> noteStorage = storage.getItem(<span class="string">'notes'</span>) ? <span class="built_in">JSON</span>.parse(storage.getItem(<span class="string">'notes'</span>)) : &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> createId = <span class="function"><span class="keyword">function</span> (<span class="params">date</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> y = date.getFullYear()</span><br><span class="line">  <span class="keyword">let</span> m = date.getMonth() + <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> d = date.getDate()</span><br><span class="line">  m = m &lt; <span class="number">10</span> ? <span class="string">'0'</span> + m : m</span><br><span class="line">  d = d &lt; <span class="number">10</span> ? <span class="string">'0'</span> + d : d</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'date'</span> + y + m + d</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> currentNote = noteStorage[currentId] ? noteStorage[currentId] : <span class="string">''</span></span><br><span class="line">...</span><br><span class="line">data () &#123;</span><br><span class="line">    ...</span><br><span class="line">    notes: noteStorage,</span><br><span class="line">    current_date: today,</span><br><span class="line">    current_note: currentNote</span><br><span class="line">    ... </span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">methods &#123;</span><br><span class="line">    ...</span><br><span class="line">    update_note: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> id = <span class="keyword">this</span>.create_id(<span class="keyword">this</span>.current_date)</span><br><span class="line">      <span class="keyword">this</span>.notes[id] = <span class="keyword">this</span>.current_note</span><br><span class="line">      storage.setItem(<span class="string">'notes'</span>, <span class="built_in">JSON</span>.stringify(<span class="keyword">this</span>.notes))</span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>模板代码为</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"note-wrap"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"note-input"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">v-model</span>=<span class="string">"current_note"</span> <span class="attr">v-on:keyup</span>=<span class="string">"update_note"</span> &gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"note-content"</span>&gt;</span></span><br><span class="line">    &#123;&#123;current_note&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>添加了notes和current_notes两个字段，和update_note方法，本来想在页面关闭时再将数据储存起来，但是并没有找到什么很好的方法来监听unload事件，所以暂时就放在keyup中吧，这样能保证数据不会丢失。</p><h1>总结一下</h1><p>至此，一个简单的记事本应用就做完了，后续需要优化的方面主要有：</p><ul><li>优化一下样式和部局，在做这个应用时候，主要考虑功能上的实现了，所以并没有在样式上花什么精力，现在看起来非常简陋，具体怎么部局好还得继续思考一下；</li><li>将编辑器替换成markdown或者富文本编辑器；</li><li>继续了解vue的一些基础用法，比如filter和事件代理，然后在慢慢的深入学习吧。<br>本来以为这样一个简单的应用很快就能完成了的，但是断断续续差不多花了两天，中途也遇到一些问题：</li><li>由于第一次使用eslint，所以一开始还按照以前的习惯写js，直接就报了一大堆错误，导致懵了很久才反应过来。</li><li>在添加了事件之后运行老是提示 scope.next_month not a function,上网查了一下也没有发现是哪里出错，后来重新npm install了一下却又能顺利运行了。<br>总之在学习vue的道路上终于迈出了第一步…</li></ul><h1>完整的组件代码</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"container clearfix"</span>&gt;</span><br><span class="line">    &lt;div id=<span class="string">"calendar-wrap"</span>&gt;</span><br><span class="line">      &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"calendar-header"</span>&gt;</span><br><span class="line">        &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"pre-month"</span> v-on:click=<span class="string">"pre_month"</span>&gt;<span class="xml"><span class="tag">&lt;&lt;/<span class="attr">span</span>&gt;</span></span></span><br><span class="line">        &lt;span&gt;&#123;&#123;current_year&#125;&#125;年&#123;&#123;current_month + <span class="number">1</span>&#125;&#125;月&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;span class="next-month" v-on:click="next_month"&gt;&gt;&lt;/</span>span&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div class="calendar-body clearfix"&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div v-for="item in week" class="cell-dom"&gt;</span></span><br><span class="line"><span class="regexp">          &#123;&#123;item&#125;&#125;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div &gt;</span><br><span class="line">        &lt;div v-<span class="keyword">for</span>=<span class="string">"day in month_arr.date"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">""</span> v-on:click=<span class="string">"update_date(day)"</span>&gt;</span><br><span class="line">          &lt;div v-<span class="keyword">if</span>=<span class="string">"is_same_day(day)"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"cell-dom current-date"</span>&gt;</span><br><span class="line">            &lt;span v-<span class="keyword">if</span>=<span class="string">"$index &lt; month_arr.preLen || $index &gt;= month_arr.preLen + month_arr.currentLen"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"disable"</span>&gt;</span><br><span class="line">              &#123;&#123;day.getDate()&#125;&#125;</span><br><span class="line">            &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">            &lt;span v-else&gt;</span></span><br><span class="line"><span class="regexp">              &#123;&#123;day.getDate()&#125;&#125;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>span&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div v-else class="cell-dom"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;span v-if="$index &lt; month_arr.preLen || $index &gt;= month_arr.preLen + month_arr.currentLen" class="disable"&gt;</span></span><br><span class="line"><span class="regexp">              &#123;&#123;day.getDate()&#125;&#125;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>span&gt;</span><br><span class="line">            &lt;span v-<span class="keyword">else</span>&gt;</span><br><span class="line">              &#123;&#123;day.getDate()&#125;&#125;</span><br><span class="line">            &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>div&gt;</span><br><span class="line">        &lt;<span class="regexp">/div &gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div id="note-wrap"&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div class="note-input"&gt;</span></span><br><span class="line"><span class="regexp">        &lt;textarea v-model="current_note" v-on:keyup="update_note" &gt;&lt;/</span>textarea&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div class="note-content"&gt;</span></span><br><span class="line"><span class="regexp">        &#123;&#123;current_note&#125;&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">let storage = window.localStorage</span></span><br><span class="line"><span class="regexp">let noteStorage = storage.getItem('notes') ? JSON.parse(storage.getItem('notes')) : &#123;&#125;</span></span><br><span class="line"><span class="regexp">let monthPanel = function (date) &#123;</span></span><br><span class="line"><span class="regexp">  var myDate = date || new Date()</span></span><br><span class="line"><span class="regexp">  var year = myDate.getFullYear()</span></span><br><span class="line"><span class="regexp">  var month = myDate.getMonth()</span></span><br><span class="line"><span class="regexp">  var currentDays = new Date(year, month + 1, 0).getDate()</span></span><br><span class="line"><span class="regexp">  var preDays = new Date(year, month, 0).getDate()</span></span><br><span class="line"><span class="regexp">  var firstDay = new Date(year, month, 1)</span></span><br><span class="line"><span class="regexp">  var firstCell = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1</span></span><br><span class="line"><span class="regexp">  var bottomCell = 42 - currentDays - firstCell</span></span><br><span class="line"><span class="regexp">  var preMonth = []</span></span><br><span class="line"><span class="regexp">  for (var p = firstCell; p &gt; 0; p--) &#123;</span></span><br><span class="line"><span class="regexp">    preMonth.push(new Date(year, month - 1, preDays - p + 1))</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  var len = preMonth.length</span></span><br><span class="line"><span class="regexp">  var currentMonth = []</span></span><br><span class="line"><span class="regexp">  for (var c = 0; c &lt; currentDays; c++) &#123;</span></span><br><span class="line"><span class="regexp">    currentMonth.push(new Date(year, month, c + 1))</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  var nextMonth = []</span></span><br><span class="line"><span class="regexp">  for (var n = 0; n &lt; bottomCell; n++) &#123;</span></span><br><span class="line"><span class="regexp">    nextMonth.push(new Date(year, month + 1, n + 1))</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  preMonth = preMonth.concat(currentMonth, nextMonth)</span></span><br><span class="line"><span class="regexp">  return &#123;</span></span><br><span class="line"><span class="regexp">    date: preMonth,</span></span><br><span class="line"><span class="regexp">    preLen: len,</span></span><br><span class="line"><span class="regexp">    currentLen: currentMonth.length</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">let createId = function (date) &#123;</span></span><br><span class="line"><span class="regexp">  let y = date.getFullYear()</span></span><br><span class="line"><span class="regexp">  let m = date.getMonth() + 1</span></span><br><span class="line"><span class="regexp">  let d = date.getDate()</span></span><br><span class="line"><span class="regexp">  m = m &lt; 10 ? '0' + m : m</span></span><br><span class="line"><span class="regexp">  d = d &lt; 10 ? '0' + d : d</span></span><br><span class="line"><span class="regexp">  return 'date' + y + m + d</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">let today = new Date()</span></span><br><span class="line"><span class="regexp">let currentYear = today.getFullYear()</span></span><br><span class="line"><span class="regexp">let currentMoth = today.getMonth()</span></span><br><span class="line"><span class="regexp">let currentId = createId(today)</span></span><br><span class="line"><span class="regexp">let currentNote = noteStorage[currentId] ? noteStorage[currentId] : ''</span></span><br><span class="line"><span class="regexp">export default &#123;</span></span><br><span class="line"><span class="regexp">  data () &#123;</span></span><br><span class="line"><span class="regexp">    return &#123;</span></span><br><span class="line"><span class="regexp">      current_year: currentYear,</span></span><br><span class="line"><span class="regexp">      current_month: currentMoth,</span></span><br><span class="line"><span class="regexp">      week: ['一', '二', '三', '四', '五', '六', '日'],</span></span><br><span class="line"><span class="regexp">      month_arr: monthPanel(today),</span></span><br><span class="line"><span class="regexp">      notes: noteStorage,</span></span><br><span class="line"><span class="regexp">      current_date: today,</span></span><br><span class="line"><span class="regexp">      current_id: currentId,</span></span><br><span class="line"><span class="regexp">      current_note: currentNote</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">  methods: &#123;</span></span><br><span class="line"><span class="regexp">    create_id: createId,</span></span><br><span class="line"><span class="regexp">    update_month: function (date) &#123;</span></span><br><span class="line"><span class="regexp">      this.month_arr = monthPanel(date)</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    update_date: function (date) &#123;</span></span><br><span class="line"><span class="regexp">      let id = this.create_id(date)</span></span><br><span class="line"><span class="regexp">      this.current_date = date</span></span><br><span class="line"><span class="regexp">      this.current_note = this.notes[id]</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    update_note: function () &#123;</span></span><br><span class="line"><span class="regexp">      let id = this.create_id(this.current_date)</span></span><br><span class="line"><span class="regexp">      this.notes[id] = this.current_note</span></span><br><span class="line"><span class="regexp">      storage.setItem('notes', JSON.stringify(this.notes))</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    next_month: function () &#123;</span></span><br><span class="line"><span class="regexp">      console.log(this.current_month)</span></span><br><span class="line"><span class="regexp">      if (this.current_month === 12) &#123;</span></span><br><span class="line"><span class="regexp">        this.current_year += 1</span></span><br><span class="line"><span class="regexp">        this.current_month = 0</span></span><br><span class="line"><span class="regexp">      &#125; else &#123;</span></span><br><span class="line"><span class="regexp">        this.current_month += 1</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">      this.update_month(new Date(this.current_year, this.current_month, 1))</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    pre_month: function () &#123;</span></span><br><span class="line"><span class="regexp">      if (this.current_month === 0) &#123;</span></span><br><span class="line"><span class="regexp">        this.current_year -= 1</span></span><br><span class="line"><span class="regexp">        this.current_month = 11</span></span><br><span class="line"><span class="regexp">      &#125; else &#123;</span></span><br><span class="line"><span class="regexp">        this.current_month -= 1</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">      this.update_month(new Date(this.current_year, this.current_month, 1))</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    is_same_day: function (date) &#123;</span></span><br><span class="line"><span class="regexp">      return date.toDateString() === this.current_date.toDateString()</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- Add <span class="string">"scoped"</span> attribute to limit CSS to <span class="keyword">this</span> component only --&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.clearfix:befor,</span><br><span class="line">.clearfix:after &#123;</span><br><span class="line">  clear: both;</span><br><span class="line">  content: <span class="string">''</span>;</span><br><span class="line">&#125;</span><br><span class="line">.current-date &#123;</span><br><span class="line">  background-color: #42b983;</span><br><span class="line">&#125;</span><br><span class="line">.disable &#123;</span><br><span class="line">  color: #BFBFBF;</span><br><span class="line">&#125;</span><br><span class="line">.container &#123;</span><br><span class="line">  width: <span class="number">80</span>%;</span><br><span class="line">  height: <span class="number">100</span>%;</span><br><span class="line">  margin-top: <span class="number">50</span>px;</span><br><span class="line">  margin-left: auto;</span><br><span class="line">  margin-right: auto;</span><br><span class="line">&#125;</span><br><span class="line">#calendar-wrap, #note-wrap &#123;</span><br><span class="line">  float: left;</span><br><span class="line">  position: relative;</span><br><span class="line">&#125;</span><br><span class="line">#calendar-wrap &#123;</span><br><span class="line">  width: <span class="number">30</span>%;</span><br><span class="line">&#125;</span><br><span class="line">#note-wrap &#123;</span><br><span class="line">  width: <span class="number">60</span>%;</span><br><span class="line">  height: <span class="number">100</span>%;</span><br><span class="line">&#125;</span><br><span class="line">.pre-month, .next-month &#123;</span><br><span class="line">  padding: <span class="number">5</span>px;</span><br><span class="line">&#125;</span><br><span class="line">.cell-dom &#123;</span><br><span class="line">  width: <span class="number">14</span>%;</span><br><span class="line">  float: left;</span><br><span class="line">  padding:<span class="number">15</span>px <span class="number">0</span>;</span><br><span class="line">  border-bottom: 1px solid #ccc;</span><br><span class="line">&#125;</span><br><span class="line">#note-wrap textarea, #note-wrap .note-content &#123;</span><br><span class="line">  width: <span class="number">45</span>%;</span><br><span class="line">  min-height: <span class="number">360</span>px;</span><br><span class="line">  display: block;</span><br><span class="line">  float: left;</span><br><span class="line">  text-align: left;</span><br><span class="line">&#125;</span><br><span class="line">#note-wrap .note-content &#123;</span><br><span class="line">  margin-left: <span class="number">5</span>%;</span><br><span class="line">  border-left: 1px solid #ccc;</span><br><span class="line">  border-right: 1px solid #ccc;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/style&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;早在vue刚出来的时候，就基本上已经把入门教程看过一遍了，但是一直没有想到合适的项目来练习，所以一直就搁置了。直前两天做日历插件的时候，在阅读日历插件源码的时候发现其原理是将所有要展示的日期计算出来存入数组，然后再根据数组生成元素添加到页面去，瞬间就想到了vue的双向数据绑定，所以决定在做完日历插件之后，便用该日历插件来做一个简易的单页应用，作为vue的入门练习。&lt;/p&gt;
    
    </summary>
    
      <category term="前端知识" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/"/>
    
    
      <category term="vuejs" scheme="http://yoursite.com/tags/vuejs/"/>
    
      <category term="javascript" scheme="http://yoursite.com/tags/javascript/"/>
    
      <category term="前端知识" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/"/>
    
      <category term="单页应用" scheme="http://yoursite.com/tags/%E5%8D%95%E9%A1%B5%E5%BA%94%E7%94%A8/"/>
    
      <category term="记事本" scheme="http://yoursite.com/tags/%E8%AE%B0%E4%BA%8B%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>一个酒店预定日历插件</title>
    <link href="http://yoursite.com/2016/07/11/%E4%B8%80%E4%B8%AA%E9%85%92%E5%BA%97%E9%A2%84%E5%AE%9A%E6%97%A5%E5%8E%86%E6%8F%92%E4%BB%B6/"/>
    <id>http://yoursite.com/2016/07/11/一个酒店预定日历插件/</id>
    <published>2016-07-11T07:09:25.000Z</published>
    <updated>2018-06-21T02:23:33.053Z</updated>
    
    <content type="html"><![CDATA[<p>由于新加入一个的公司是一个旅游公司，所以会涉及到酒店预订，但是随便搜索了一下，网上没找到适合的日历插件，而现在时间也比较多，便考虑自己实现一个，顺便提高一下自己的js水平。 <a id="more"></a></p><h1>确定需求</h1><p>酒店预订的插件主要功能有下面两几点：</p><ul><li>从服务器获取日历信息并展示；</li><li>可以选择入住时间和离开时间；</li><li>选中的日期使用特殊的样式进行展示；</li><li>能够获取选中的时间段信息。<br>但是以上只是前台预订的功能，而我的构想是这个插件可以前后台通用，所以还得加上后台设置的功能，通过创建时参数的设定来确定是前台使用，还是后台设置数据。<br>后台设置的需求有：</li><li>从服务器获取日历信息并展示；</li><li>能够通过点击日期来设定或者修改当日的信息；</li><li>能够获取到设置好的数据储存或者传递到服务器；<br>需求确定了就可以开始动手了做了。</li></ul><h1>构建一个日历面板</h1><p>作为一个日历插件，最基础的部分当然是实现一个日历面板，然后再给日历上的每一天加上相应的点击事件，对于一个从来没有写过日历插件的我来说，能想到的当然是搜索一下js如何实现一个日历插件，然后发现已经大神实现了完整的日历面板，<a href="http://www.cnphp6.com/archives/38454" target="_blank" rel="noopener">javascript动手写日历组件</a>,基本上满足我所需要的功能，所以就不重复造轮子了，接下来就是在其基础上加以修改，将前后台的事件逻辑添加进去，实现我所需要的功能。原作者的完整源码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">+------------------------------</span></span><br><span class="line"><span class="comment">@author:vczero</span></span><br><span class="line"><span class="comment">@time:2014/8/10</span></span><br><span class="line"><span class="comment">@desc:简易日历组件</span></span><br><span class="line"><span class="comment">+------------------------------</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> Calendar = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> Calendar = <span class="function"><span class="keyword">function</span>(<span class="params">div, date</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.div = <span class="built_in">document</span>.getElementById(div);</span><br><span class="line">        <span class="keyword">var</span> w = <span class="keyword">this</span>.div.style.width || <span class="number">390</span>;</span><br><span class="line">        <span class="keyword">var</span> h = <span class="keyword">this</span>.div.style.height || (<span class="number">300</span> - <span class="number">30</span>);</span><br><span class="line">        <span class="keyword">this</span>.width = <span class="built_in">parseInt</span>(w) &gt;= <span class="number">360</span> ? w : <span class="number">360</span>; </span><br><span class="line">        <span class="keyword">this</span>.height = <span class="built_in">parseInt</span>(h) &gt;= <span class="number">180</span> ? h : <span class="number">180</span>;</span><br><span class="line">        <span class="keyword">this</span>.date = date;</span><br><span class="line">        <span class="keyword">this</span>.div.style.width = <span class="keyword">this</span>.width + <span class="string">'px'</span>; <span class="comment">//按默认值设置回去</span></span><br><span class="line">        <span class="keyword">this</span>.div.style.height = <span class="keyword">this</span>.height + <span class="string">'px'</span>;<span class="comment">//按默认值设置回去</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    Calendar.week = [<span class="string">'星期一'</span>, <span class="string">'星期二'</span>,<span class="string">'星期三'</span>, <span class="string">'星期四'</span>,<span class="string">'星期五'</span>, <span class="string">'星期六'</span>, <span class="string">'星期日'</span>];</span><br><span class="line"></span><br><span class="line">    Calendar.prototype[<span class="string">'showUI'</span>] = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> exist = <span class="built_in">document</span>.getElementById(<span class="string">'vczero_celldom_0'</span>);</span><br><span class="line">        <span class="keyword">if</span>(!!exist)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> e = <span class="number">0</span>; e &lt; <span class="number">42</span>; e++)&#123;</span><br><span class="line">                <span class="keyword">var</span> node = <span class="built_in">document</span>.getElementById(<span class="string">'vczero_celldom_'</span> + e);</span><br><span class="line">                node.onclick = <span class="literal">null</span>; <span class="comment">//移除事件处理程序</span></span><br><span class="line">                <span class="keyword">this</span>.div.removeChild(node);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> width = <span class="keyword">this</span>.width,</span><br><span class="line">            height = <span class="keyword">this</span>.height,</span><br><span class="line">            cell = &#123;<span class="attr">width</span>: (<span class="built_in">parseInt</span>(width) - <span class="number">20</span>)/<span class="number">7</span>, <span class="attr">height</span>: (<span class="built_in">parseInt</span>(height) <span class="number">-30</span> - <span class="number">20</span>)/<span class="number">6</span>&#125;,</span><br><span class="line">            monthArr = <span class="keyword">this</span>._monthPanel(<span class="keyword">this</span>.date);</span><br><span class="line">        <span class="keyword">this</span>.div.style.paddingLeft = <span class="string">'8px'</span>; </span><br><span class="line">        <span class="keyword">this</span>.div.style.border = <span class="string">'2px solid #57ABFF'</span>;</span><br><span class="line">        <span class="keyword">this</span>.div.style.cursor = <span class="string">'default'</span>;</span><br><span class="line">        <span class="keyword">this</span>.div.style.fontFamily = <span class="string">'微软雅黑'</span>;</span><br><span class="line">        <span class="keyword">this</span>._addHeader();</span><br><span class="line">        <span class="keyword">this</span>._addWeekday();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">42</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">var</span> cellDOM = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">            cellDOM.style.width = cell.width + <span class="string">'px'</span>;</span><br><span class="line">            cellDOM.style.height = cell.height + <span class="string">'px'</span>;</span><br><span class="line">            cellDOM.style.display = <span class="string">'inline-block'</span>;</span><br><span class="line">            cellDOM.style.cssFloat = <span class="string">'left'</span>;</span><br><span class="line">            cellDOM.style.cursor = <span class="string">'pointer'</span>;</span><br><span class="line">            cellDOM.style.textAlign = <span class="string">'center'</span>;</span><br><span class="line">            cellDOM.id = <span class="string">'vczero_celldom_'</span> + i;</span><br><span class="line">            cellDOM.style.lineHeight = cell.height + <span class="string">'px'</span>;</span><br><span class="line">            cellDOM.setAttribute(<span class="string">'date'</span>,monthArr.date[i]); <span class="comment">//设置日期对象到DOM属性date上</span></span><br><span class="line">            cellDOM.innerHTML = monthArr.date[i].getDate();</span><br><span class="line">            <span class="comment">//去掉最后一行横线</span></span><br><span class="line">            <span class="keyword">if</span>(i &lt; <span class="number">35</span>)&#123;</span><br><span class="line">                cellDOM.style.borderBottom = <span class="string">'1px solid #C8CACC'</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(i &lt; monthArr.preLen || i &gt;= monthArr.currentLen + monthArr.preLen)&#123;</span><br><span class="line">                cellDOM.style.color = <span class="string">'#BFBFBF'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>.div.appendChild(cellDOM);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用父元素事件委托</span></span><br><span class="line">        <span class="keyword">this</span>.div.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> node = e.target;</span><br><span class="line">            <span class="keyword">if</span>(node.id.indexOf(<span class="string">'vczero_celldom_'</span>) &gt; <span class="number">-1</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(node.getAttribute(<span class="string">'date'</span>)).toLocaleString();</span><br><span class="line">                callback(date);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    Calendar.prototype._addHeader = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> exist = <span class="built_in">document</span>.getElementById(<span class="string">'vczero_datediv'</span>);</span><br><span class="line">        <span class="keyword">if</span>(!!exist)&#123;</span><br><span class="line">            exist.onclick = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">this</span>.div.removeChild(exist);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> header = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">        header.style.height = <span class="string">'22px'</span>;</span><br><span class="line">        header.style.width = <span class="keyword">this</span>.div.style.width || <span class="string">'800px'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//包含左 时间 右的大DIV</span></span><br><span class="line">        <span class="keyword">var</span> dateDiv = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">        dateDiv.style.width = <span class="string">'200px'</span>;</span><br><span class="line">        dateDiv.style.height = <span class="string">'22px'</span>;</span><br><span class="line">        dateDiv.style.margin = <span class="string">'0 auto'</span>;</span><br><span class="line">        dateDiv.style.textAlign = <span class="string">'center'</span>;</span><br><span class="line">        dateDiv.style.fontWeight = <span class="string">'bold'</span>;</span><br><span class="line">        dateDiv.id = <span class="string">'vczero_datediv'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//&lt; DIV</span></span><br><span class="line">        <span class="keyword">var</span> leftDiv = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">        leftDiv.innerHTML = <span class="string">'&lt;'</span>;</span><br><span class="line">        leftDiv.style.display = <span class="string">'inline-block'</span>;</span><br><span class="line">        leftDiv.style.float = <span class="string">'left'</span>;</span><br><span class="line">        leftDiv.style.width = <span class="string">'50px'</span>;</span><br><span class="line">        leftDiv.style.cursor = <span class="string">'pointer'</span>;</span><br><span class="line">        leftDiv.style.color = <span class="string">'#C5BFBF'</span>;</span><br><span class="line">        <span class="keyword">var</span> _that = <span class="keyword">this</span>; <span class="comment">//获取到this对象</span></span><br><span class="line">        leftDiv.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> year = <span class="built_in">parseInt</span>(_that.date.getFullYear()),</span><br><span class="line">                month = <span class="built_in">parseInt</span>(_that.date.getMonth());</span><br><span class="line">            <span class="keyword">if</span>(month === <span class="number">0</span>)&#123;</span><br><span class="line">                _that.date = <span class="keyword">new</span> <span class="built_in">Date</span>(year - <span class="number">1</span>, <span class="number">11</span>, <span class="number">1</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                _that.date = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month - <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            _that[<span class="string">'showUI'</span>](<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;);</span><br><span class="line">            </span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//&gt; DIV</span></span><br><span class="line">        <span class="keyword">var</span> rightDiv = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">        rightDiv.innerHTML = <span class="string">'&gt;'</span>;</span><br><span class="line">        rightDiv.style.display = <span class="string">'inline-block'</span>;</span><br><span class="line">        rightDiv.style.float = <span class="string">'left'</span>;</span><br><span class="line">        rightDiv.style.width = <span class="string">'50px'</span>;</span><br><span class="line">        rightDiv.style.cursor = <span class="string">'pointer'</span>;</span><br><span class="line">        rightDiv.style.color = <span class="string">'#C5BFBF'</span>;</span><br><span class="line">        rightDiv.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> year = <span class="built_in">parseInt</span>(_that.date.getFullYear()),</span><br><span class="line">                month = <span class="built_in">parseInt</span>(_that.date.getMonth());</span><br><span class="line">            <span class="keyword">if</span>(month === <span class="number">11</span>)&#123;</span><br><span class="line">                _that.date = <span class="keyword">new</span> <span class="built_in">Date</span>(year + <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                _that.date = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month + <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            _that[<span class="string">'showUI'</span>](<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//显示月份的DIV</span></span><br><span class="line">        <span class="keyword">var</span> timeDiv = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">        timeDiv.style.display = <span class="string">'inline-block'</span>;</span><br><span class="line">        timeDiv.style.float = <span class="string">'left'</span>;</span><br><span class="line">        timeDiv.style.width = <span class="string">'100px'</span>;</span><br><span class="line">        timeDiv.innerHTML = <span class="keyword">this</span>.date.getFullYear() + <span class="string">'年'</span> + (<span class="keyword">this</span>.date.getMonth() + <span class="number">1</span>) + <span class="string">'月'</span>;</span><br><span class="line"></span><br><span class="line">        dateDiv.appendChild(leftDiv);</span><br><span class="line">        dateDiv.appendChild(timeDiv);</span><br><span class="line">        dateDiv.appendChild(rightDiv);</span><br><span class="line">        <span class="keyword">this</span>.div.appendChild(dateDiv);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//增加星期</span></span><br><span class="line">    Calendar.prototype._addWeekday = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> exist = <span class="built_in">document</span>.getElementById(<span class="string">'vczero_week_0'</span>);</span><br><span class="line">        <span class="keyword">if</span>(!!exist)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++)&#123;</span><br><span class="line">                <span class="keyword">var</span> node = <span class="built_in">document</span>.getElementById(<span class="string">'vczero_week_'</span> + i);</span><br><span class="line">                node.onclick = <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">this</span>.div.removeChild(node);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> n = <span class="number">0</span>; n &lt; <span class="number">7</span>; n++)&#123;</span><br><span class="line">            <span class="keyword">var</span> weekday = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">            weekday.style.width = (<span class="built_in">parseInt</span>(<span class="keyword">this</span>.width) - <span class="number">20</span>)/<span class="number">7</span> + <span class="string">'px'</span>;</span><br><span class="line">            weekday.style.height = <span class="string">'20px'</span>;</span><br><span class="line">            weekday.style.display = <span class="string">'inline-block'</span>;</span><br><span class="line">            weekday.style.float = <span class="string">'left'</span>;</span><br><span class="line">            weekday.style.color = <span class="string">'#BFBFBF'</span>;</span><br><span class="line">            weekday.style.fontWeight = <span class="string">'bold'</span>;</span><br><span class="line">            weekday.style.textAlign = <span class="string">'center'</span>;</span><br><span class="line">            weekday.id = <span class="string">'vczero_week_'</span> + n;</span><br><span class="line">            weekday.innerHTML = Calendar.week[n];</span><br><span class="line">            <span class="keyword">this</span>.div.appendChild(weekday);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    Calendar.prototype._monthPanel = <span class="function"><span class="keyword">function</span>(<span class="params">date</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//如果传递了Date对象，则按Date对象进行计算月份面板</span></span><br><span class="line">        <span class="comment">//否则，按照当前月份计算面板</span></span><br><span class="line">        <span class="keyword">var</span> myDate = date || <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">            year = myDate.getFullYear(),</span><br><span class="line">            month = myDate.getMonth(),</span><br><span class="line">            day = myDate.getDate(),</span><br><span class="line">            week = myDate.getDay(),</span><br><span class="line">            currentDays = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month + <span class="number">1</span>, <span class="number">0</span>).getDate(),</span><br><span class="line">            preDays = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month, <span class="number">0</span>).getDate(),</span><br><span class="line">            firstDay = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month, <span class="number">1</span>),</span><br><span class="line">            firstCell = firstDay.getDay() === <span class="number">0</span> ? <span class="number">6</span> : firstDay.getDay() - <span class="number">1</span>,</span><br><span class="line">            bottomCell =  <span class="number">42</span> - currentDays - firstCell;</span><br><span class="line">        <span class="comment">//前一个月该显示多少天</span></span><br><span class="line">        <span class="keyword">var</span> preMonth = [];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> p = firstCell; p &gt; <span class="number">0</span>; p--)&#123;</span><br><span class="line">            preMonth.push(<span class="keyword">new</span> <span class="built_in">Date</span>(year, month - <span class="number">1</span>, preDays - p + <span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> len = preMonth.length;</span><br><span class="line">        <span class="comment">//本月</span></span><br><span class="line">        <span class="keyword">var</span> currentMonth = [];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> c = <span class="number">0</span>; c &lt; currentDays; c++)&#123;</span><br><span class="line">            currentMonth.push(<span class="keyword">new</span> <span class="built_in">Date</span>(year, month, c + <span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//下一个月</span></span><br><span class="line">        <span class="keyword">var</span> nextMonth = [];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> n = <span class="number">0</span>; n &lt; bottomCell; n++)&#123;</span><br><span class="line">            nextMonth.push(<span class="keyword">new</span> <span class="built_in">Date</span>(year, month + <span class="number">1</span>, n + <span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        preMonth = preMonth.concat(currentMonth, nextMonth);</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            date: preMonth,</span><br><span class="line">            preLen: len,</span><br><span class="line">            currentLen: currentMonth.length</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Calendar;</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure><p>使用方式原作者的博客也有说明了，主要是：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c = <span class="keyword">new</span> Calendar(<span class="string">'calendar'</span>,<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">c.showUI(<span class="function"><span class="keyword">function</span>(<span class="params">date</span>)</span>&#123;</span><br><span class="line">    alert(date);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>在研究了一下完整的源码之后，发现要实现我所需要的功能，得做以下修改：</p><ul><li>在调用插件时，增加一些配置参数，除了传入date之外，还需要传入一个包含需要展示在日期上的信息json，点击事件的回调函数以及使用场景是后台还是前台，将传入的变量储存起来以便后续使用；</li><li>修改showUI函数将信息展示出来；</li><li>为了在对应的日期上展示相应日期的信息，所以日期信息需要一个根据日期生成的唯一id；</li><li>如果是在后台使用，增加一个可以输入信息的模态框，并可以将输入的信息储存起来；</li><li>设置完之后，提供一个获取日期信息的接口。</li></ul><h1>增加创建时传入的参数</h1><p>由于除了传入一个date之外，还有其他三个参数，所以我选择将传入的第二个参数改成一个json：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c = <span class="keyword">new</span> Calendar(<span class="string">'calendar'</span>,&#123;</span><br><span class="line">            <span class="string">'date'</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(), <span class="comment">//创建日历的基本日期</span></span><br><span class="line">            <span class="string">'info'</span>: &#123; </span><br><span class="line">                <span class="comment">//日期的信息</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">'callback'</span>: <span class="function"><span class="keyword">function</span>(<span class="params">node,date</span>) </span>&#123; </span><br><span class="line">                    <span class="comment">//日历点击事件,在点击时会将被点击的元素，和日期对象传入该function；</span></span><br><span class="line">                &#125;,</span><br><span class="line">            <span class="string">'scense'</span>: <span class="string">'set'</span> <span class="comment">//使用场景</span></span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><p>然后在插件中将参数储存为变量，供后续使用：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.date = options.date;</span><br><span class="line"><span class="keyword">this</span>.dateInfo = options.info ? options.info : &#123;&#125;;</span><br><span class="line"><span class="keyword">this</span>.scense = options.scense ? options.scense : <span class="string">'get'</span>;</span><br><span class="line"><span class="keyword">this</span>.callback = options.callback ? options.callback : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="keyword">this</span>.activeDate = <span class="keyword">new</span> <span class="built_in">Date</span>(); <span class="comment">//最后被点击的日期，后续需要用到，所以先初始化了</span></span><br></pre></td></tr></table></figure><h1>将传入的信息展示在日历上</h1><p>首先为了日历信息能够能日期匹配，所以得设计一套数据结构，我为了方便存取，使用了如下的数据结构：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">'date20160706'</span>:&#123;<span class="string">'价格'</span>: <span class="number">100</span>, <span class="string">'数量'</span>: <span class="number">100</span>&#125;,</span><br><span class="line">    <span class="string">'date20160806'</span>:&#123;<span class="string">'价格'</span>: <span class="number">100</span>, <span class="string">'数量'</span>: <span class="number">100</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中id是根据日期生成的，可以保证其唯一性，具体方法为date+年月日：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//生成一个日期id，用于存取日期信息；</span></span><br><span class="line">Calendar.prototype._id = <span class="function"><span class="keyword">function</span>(<span class="params">date</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> y = date.getFullYear();</span><br><span class="line">    <span class="keyword">var</span> m = date.getMonth() + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> d = date.getDate();</span><br><span class="line">    m = m &lt; <span class="number">10</span> ? <span class="string">'0'</span> + m : m;</span><br><span class="line">    d = d &lt; <span class="number">10</span> ? <span class="string">'0'</span> + d : d;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'date'</span> + y + m + d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在生成日历元素的时候，如果发现有当天的日历信息，那么就将其展示在元素。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> id = <span class="keyword">this</span>._id(monthArr.date[i])</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">this</span>.dateInfo[id]) &#123;</span><br><span class="line">        innerHTML +=  <span class="string">'('</span> + <span class="keyword">this</span>.dateInfo[id][<span class="string">'价格'</span>] + <span class="string">')'</span>;<span class="comment">//将当天价格展示出来</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>添加一个输入的模态框并将输入的信息保存进日历信息</h1><p>当模式为后台设置时，需要设置每一天的日历信息，所以当点击日期时，模态框显示，当输入完确定之后，将信息存起来并隐藏模态框，点击取消时将模态框隐藏，考虑到可能需要输入很多不同的字段，所以在模态框中设置了两个input，分别对应当日信息的key和value，方便以后扩展。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Calendar.prototype._createInputModal = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _that = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">var</span> modalDiv = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);<span class="comment">//创建模态框div</span></span><br><span class="line">    modalDiv.id = <span class="string">'calemdar-input-modal'</span>;</span><br><span class="line">    modalDiv.style.display = <span class="string">'none'</span>;</span><br><span class="line">    modalDiv.style.zIndex = <span class="number">999</span>;</span><br><span class="line">    modalDiv.style.width = <span class="string">'150px'</span>;</span><br><span class="line">    modalDiv.style.height = <span class="string">'100px'</span>;</span><br><span class="line">    modalDiv.style.position = <span class="string">'absolute'</span>;</span><br><span class="line">    modalDiv.style.right = <span class="string">'-155px'</span>;</span><br><span class="line">    <span class="keyword">var</span> keyInput = <span class="built_in">document</span>.createElement(<span class="string">'input'</span>);</span><br><span class="line">    keyInput.id = <span class="string">'key-input'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加输入框和按钮</span></span><br><span class="line">    modalDiv.innerHTML = <span class="string">'key：&lt;input type="text" id="calendar-key-input"/&gt;&lt;br/&gt;value：&lt;input type="text" id="calendar-value-input" /&gt;&lt;br/&gt;&lt;/br&gt;&lt;button id="calendar-sure-btn"&gt;确定&lt;/button&gt;&amp;nbsp&amp;nbsp&lt;button id="calendar-cancel-btn"&gt;取消&lt;/button&gt;'</span>;</span><br><span class="line">    <span class="keyword">this</span>.div.appendChild(modalDiv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//为确定按钮添加事件</span></span><br><span class="line">    <span class="keyword">var</span> keyInput = <span class="built_in">document</span>.getElementById(<span class="string">'calendar-key-input'</span>);</span><br><span class="line">    <span class="keyword">var</span> valInput = <span class="built_in">document</span>.getElementById(<span class="string">'calendar-value-input'</span>);</span><br><span class="line">    <span class="keyword">var</span> surebtn = <span class="built_in">document</span>.getElementById(<span class="string">'calendar-sure-btn'</span>);</span><br><span class="line">    surebtn.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> key = keyInput.value;</span><br><span class="line">        <span class="keyword">var</span> val = valInput.value;</span><br><span class="line">        <span class="keyword">if</span>(key != <span class="string">''</span> &amp;&amp; val != <span class="string">''</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> id = _that._id(_that.activeDate);</span><br><span class="line">            <span class="keyword">if</span>(_that.dateInfo.id) &#123;</span><br><span class="line">                _that.dateInfo.id[key] = val;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                _that.dateInfo[id] = &#123;&#125;;</span><br><span class="line">                _that.dateInfo[id][key] = val;</span><br><span class="line">            &#125;</span><br><span class="line">            _that[<span class="string">'showUI'</span>](<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;); <span class="comment">//重绘当前日历</span></span><br><span class="line">            modalDiv.style.display = <span class="string">'none'</span>;</span><br><span class="line">            keyInput.value = <span class="string">''</span>;</span><br><span class="line">            valInput.value = <span class="string">''</span>;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">//为cancel按钮添加事件</span></span><br><span class="line">    <span class="keyword">var</span> cancelbtn = <span class="built_in">document</span>.getElementById(<span class="string">'calendar-cancel-btn'</span>);</span><br><span class="line">    cancelbtn.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        modalDiv.style.display = <span class="string">'none'</span>;</span><br><span class="line">        keyInput.value = <span class="string">''</span>;</span><br><span class="line">        valInput.value = <span class="string">''</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>增加获取日历信息的函数</h1><p>在设置完了之后，为了方便将数据存入本地存储或者传入后端数据库，所以需要获取到最新的日历信息：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Calendar.prototype._getDateInfo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.dateInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>总结</h1><p>至此，一个可以供酒店预订的日历插件基本上已经完成了，还需要做得事情有调整UI，以适应信息的展示，界面也更漂亮一些，后续可能会将其改为jquery版本，或者使用vuejs来做一个备忘录的单页应用吧。<br>以下是完整的测试代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        .actived-cell  &#123;</span></span><br><span class="line"><span class="undefined">            background-color: blue;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> Calendar = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> Calendar = <span class="function"><span class="keyword">function</span>(<span class="params">div, options</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.div = <span class="built_in">document</span>.getElementById(div);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> options = options</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> w = <span class="keyword">this</span>.div.style.width || <span class="number">390</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> h = <span class="keyword">this</span>.div.style.height || (<span class="number">300</span> - <span class="number">30</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.width = <span class="built_in">parseInt</span>(w) &gt;= <span class="number">360</span> ? w : <span class="number">360</span>; </span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.height = <span class="built_in">parseInt</span>(h) &gt;= <span class="number">180</span> ? h : <span class="number">180</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.date = options.date;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.dateInfo = options.info ? options.info : &#123;&#125;;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.scense = options.scense ? options.scense : <span class="string">'get'</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.callback = options.callback ? options.callback : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.activeDate = <span class="keyword">new</span> <span class="built_in">Date</span>(); <span class="comment">//最后被点击的日期，后续需要用到，所以先初始化了 </span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.div.style.width = <span class="keyword">this</span>.width + <span class="string">'px'</span>; <span class="comment">//按默认值设置回去</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.div.style.height = <span class="keyword">this</span>.height + <span class="string">'px'</span>;<span class="comment">//按默认值设置回去</span></span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    Calendar.week = [<span class="string">'一'</span>, <span class="string">'二'</span>,<span class="string">'三'</span>, <span class="string">'四'</span>,<span class="string">'五'</span>, <span class="string">'六'</span>, <span class="string">'日'</span>];</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    Calendar.prototype[<span class="string">'showUI'</span>] = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> exist = <span class="built_in">document</span>.getElementById(<span class="string">'vczero_celldom_0'</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(!!exist)&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span>(<span class="keyword">var</span> e = <span class="number">0</span>; e &lt; <span class="number">42</span>; e++)&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> node = <span class="built_in">document</span>.getElementById(<span class="string">'vczero_celldom_'</span> + e);</span></span><br><span class="line"><span class="javascript">                node.onclick = <span class="literal">null</span>; <span class="comment">//移除事件处理程序</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.div.removeChild(node);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> width = <span class="keyword">this</span>.width,</span></span><br><span class="line"><span class="javascript">            height = <span class="keyword">this</span>.height,</span></span><br><span class="line"><span class="javascript">            cell = &#123;<span class="attr">width</span>: (<span class="built_in">parseInt</span>(width) - <span class="number">20</span>)/<span class="number">7</span>, <span class="attr">height</span>: (<span class="built_in">parseInt</span>(height) <span class="number">-30</span> - <span class="number">20</span>)/<span class="number">6</span>&#125;,</span></span><br><span class="line"><span class="javascript">            monthArr = <span class="keyword">this</span>._monthPanel(<span class="keyword">this</span>.date);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.div.style.paddingLeft = <span class="string">'8px'</span>; </span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.div.style.border = <span class="string">'2px solid #57ABFF'</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.div.style.cursor = <span class="string">'default'</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.div.style.fontFamily = <span class="string">'微软雅黑'</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>._addHeader();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>._addWeekday();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>._createInputModal();</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">42</span>; i++)&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> cellDOM = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span></span><br><span class="line"><span class="javascript">            cellDOM.style.width = cell.width + <span class="string">'px'</span>;</span></span><br><span class="line"><span class="javascript">            cellDOM.style.height = cell.height + <span class="string">'px'</span>;</span></span><br><span class="line"><span class="javascript">            cellDOM.style.display = <span class="string">'inline-block'</span>;</span></span><br><span class="line"><span class="javascript">            cellDOM.style.cssFloat = <span class="string">'left'</span>;</span></span><br><span class="line"><span class="javascript">            cellDOM.style.cursor = <span class="string">'pointer'</span>;</span></span><br><span class="line"><span class="javascript">            cellDOM.style.textAlign = <span class="string">'center'</span>;</span></span><br><span class="line"><span class="javascript">            cellDOM.id = <span class="string">'vczero_celldom_'</span> + i;</span></span><br><span class="line"><span class="javascript">            cellDOM.style.lineHeight = cell.height + <span class="string">'px'</span>;</span></span><br><span class="line"><span class="javascript">            cellDOM.setAttribute(<span class="string">'date'</span>,monthArr.date[i]); <span class="comment">//设置日期对象到DOM属性date上</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> innerHTML = monthArr.date[i].getDate();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> id = <span class="keyword">this</span>._id(monthArr.date[i])</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(<span class="keyword">this</span>.dateInfo[id]) &#123;</span></span><br><span class="line"><span class="javascript">                    innerHTML +=  <span class="string">'('</span> + <span class="keyword">this</span>.dateInfo[id][<span class="string">'价格'</span>] + <span class="string">')'</span>;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">            cellDOM.innerHTML = innerHTML;</span></span><br><span class="line"><span class="javascript">            <span class="comment">//去掉最后一行横线</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(i &lt; <span class="number">35</span>)&#123; </span></span><br><span class="line"><span class="javascript">                cellDOM.style.borderBottom = <span class="string">'1px solid #C8CACC'</span>;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(i &lt; monthArr.preLen || i &gt;= monthArr.currentLen + monthArr.preLen)&#123;</span></span><br><span class="line"><span class="javascript">                cellDOM.style.color = <span class="string">'#BFBFBF'</span>;</span></span><br><span class="line"><span class="javascript">                cellDOM.classList.add(<span class="string">'disabled'</span>)</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">this</span>.div.appendChild(cellDOM);</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//使用父元素事件委托</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> _that = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> inputModal = <span class="built_in">document</span>.getElementById(<span class="string">'calemdar-input-modal'</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.div.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> node = e.target;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> nodeClass = node.classList;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(node.id.indexOf(<span class="string">'vczero_celldom_'</span>) &gt; <span class="number">-1</span> &amp;&amp; !nodeClass.contains(<span class="string">'disabled'</span>))&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(node.getAttribute(<span class="string">'date'</span>));</span></span><br><span class="line"><span class="undefined">                _that.activeDate = date;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span>(_that.scense == <span class="string">'set'</span>) &#123;</span></span><br><span class="line"><span class="javascript">                    inputModal.style.display  = <span class="string">'block'</span>;</span></span><br><span class="line"><span class="javascript">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(_that.scense == <span class="string">'get'</span>) &#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">                _that.callback(node, date);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    Calendar.prototype._addHeader = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> exist = <span class="built_in">document</span>.getElementById(<span class="string">'vczero_datediv'</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(!!exist)&#123;</span></span><br><span class="line"><span class="javascript">            exist.onclick = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">this</span>.div.removeChild(exist);</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> header = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span></span><br><span class="line"><span class="javascript">        header.style.height = <span class="string">'22px'</span>;</span></span><br><span class="line"><span class="javascript">        header.style.width = <span class="keyword">this</span>.div.style.width || <span class="string">'800px'</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//包含左 时间 右的大DIV</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> dateDiv = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span></span><br><span class="line"><span class="javascript">        dateDiv.style.width = <span class="string">'200px'</span>;</span></span><br><span class="line"><span class="javascript">        dateDiv.style.height = <span class="string">'22px'</span>;</span></span><br><span class="line"><span class="javascript">        dateDiv.style.margin = <span class="string">'0 auto'</span>;</span></span><br><span class="line"><span class="javascript">        dateDiv.style.textAlign = <span class="string">'center'</span>;</span></span><br><span class="line"><span class="javascript">        dateDiv.style.fontWeight = <span class="string">'bold'</span>;</span></span><br><span class="line"><span class="javascript">        dateDiv.style.padding = <span class="string">'10px'</span>;</span></span><br><span class="line"><span class="javascript">        dateDiv.id = <span class="string">'vczero_datediv'</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//&lt; DIV</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> leftDiv = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span></span><br><span class="line"><span class="javascript">        leftDiv.innerHTML = <span class="string">'&lt;'</span>;</span></span><br><span class="line"><span class="javascript">        leftDiv.style.display = <span class="string">'inline-block'</span>;</span></span><br><span class="line"><span class="javascript">        leftDiv.style.float = <span class="string">'left'</span>;</span></span><br><span class="line"><span class="javascript">        leftDiv.style.width = <span class="string">'50px'</span>;</span></span><br><span class="line"><span class="javascript">        leftDiv.style.cursor = <span class="string">'pointer'</span>;</span></span><br><span class="line"><span class="javascript">        leftDiv.style.color = <span class="string">'#C5BFBF'</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> _that = <span class="keyword">this</span>; <span class="comment">//获取到this对象</span></span></span><br><span class="line"><span class="javascript">        leftDiv.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> year = <span class="built_in">parseInt</span>(_that.date.getFullYear()),</span></span><br><span class="line"><span class="javascript">                month = <span class="built_in">parseInt</span>(_that.date.getMonth());</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(month === <span class="number">0</span>)&#123;</span></span><br><span class="line"><span class="javascript">                _that.date = <span class="keyword">new</span> <span class="built_in">Date</span>(year - <span class="number">1</span>, <span class="number">11</span>, <span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">            &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">                _that.date = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month - <span class="number">1</span>, <span class="number">1</span>);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="javascript">            _that[<span class="string">'showUI'</span>](<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;);</span></span><br><span class="line"><span class="undefined">            </span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//&gt; DIV</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> rightDiv = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span></span><br><span class="line"><span class="javascript">        rightDiv.innerHTML = <span class="string">'&gt;'</span>;</span></span><br><span class="line"><span class="javascript">        rightDiv.style.display = <span class="string">'inline-block'</span>;</span></span><br><span class="line"><span class="javascript">        rightDiv.style.float = <span class="string">'left'</span>;</span></span><br><span class="line"><span class="javascript">        rightDiv.style.width = <span class="string">'50px'</span>;</span></span><br><span class="line"><span class="javascript">        rightDiv.style.cursor = <span class="string">'pointer'</span>;</span></span><br><span class="line"><span class="javascript">        rightDiv.style.color = <span class="string">'#C5BFBF'</span>;</span></span><br><span class="line"><span class="javascript">        rightDiv.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> year = <span class="built_in">parseInt</span>(_that.date.getFullYear()),</span></span><br><span class="line"><span class="javascript">                month = <span class="built_in">parseInt</span>(_that.date.getMonth());</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(month === <span class="number">11</span>)&#123;</span></span><br><span class="line"><span class="javascript">                _that.date = <span class="keyword">new</span> <span class="built_in">Date</span>(year + <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">            &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">                _that.date = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month + <span class="number">1</span>, <span class="number">1</span>);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="javascript">            _that[<span class="string">'showUI'</span>](<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;);</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//显示月份的DIV</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> timeDiv = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span></span><br><span class="line"><span class="javascript">        timeDiv.style.display = <span class="string">'inline-block'</span>;</span></span><br><span class="line"><span class="javascript">        timeDiv.style.float = <span class="string">'left'</span>;</span></span><br><span class="line"><span class="javascript">        timeDiv.style.width = <span class="string">'100px'</span>;</span></span><br><span class="line"><span class="javascript">        timeDiv.innerHTML = <span class="keyword">this</span>.date.getFullYear() + <span class="string">'年'</span> + (<span class="keyword">this</span>.date.getMonth() + <span class="number">1</span>) + <span class="string">'月'</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        dateDiv.appendChild(leftDiv);</span></span><br><span class="line"><span class="undefined">        dateDiv.appendChild(timeDiv);</span></span><br><span class="line"><span class="undefined">        dateDiv.appendChild(rightDiv);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.div.appendChild(dateDiv);</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">//增加星期</span></span></span><br><span class="line"><span class="javascript">    Calendar.prototype._addWeekday = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> exist = <span class="built_in">document</span>.getElementById(<span class="string">'vczero_week_0'</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(!!exist)&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++)&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> node = <span class="built_in">document</span>.getElementById(<span class="string">'vczero_week_'</span> + i);</span></span><br><span class="line"><span class="javascript">                node.onclick = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.div.removeChild(node);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">            </span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> n = <span class="number">0</span>; n &lt; <span class="number">7</span>; n++)&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> weekday = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span></span><br><span class="line"><span class="javascript">            weekday.style.width = (<span class="built_in">parseInt</span>(<span class="keyword">this</span>.width) - <span class="number">20</span>)/<span class="number">7</span> + <span class="string">'px'</span>;</span></span><br><span class="line"><span class="javascript">            weekday.style.height = <span class="string">'20px'</span>;</span></span><br><span class="line"><span class="javascript">            weekday.style.display = <span class="string">'inline-block'</span>;</span></span><br><span class="line"><span class="javascript">            weekday.style.float = <span class="string">'left'</span>;</span></span><br><span class="line"><span class="javascript">            weekday.style.color = <span class="string">'#BFBFBF'</span>;</span></span><br><span class="line"><span class="javascript">            weekday.style.fontWeight = <span class="string">'bold'</span>;</span></span><br><span class="line"><span class="javascript">            weekday.style.textAlign = <span class="string">'center'</span>;</span></span><br><span class="line"><span class="javascript">            weekday.id = <span class="string">'vczero_week_'</span> + n;</span></span><br><span class="line"><span class="undefined">            weekday.innerHTML = Calendar.week[n];</span></span><br><span class="line"><span class="javascript">            <span class="keyword">this</span>.div.appendChild(weekday);</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    Calendar.prototype._monthPanel = <span class="function"><span class="keyword">function</span>(<span class="params">date</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//如果传递了Date对象，则按Date对象进行计算月份面板</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//否则，按照当前月份计算面板</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> myDate = date || <span class="keyword">new</span> <span class="built_in">Date</span>(),</span></span><br><span class="line"><span class="undefined">            year = myDate.getFullYear(),</span></span><br><span class="line"><span class="undefined">            month = myDate.getMonth(),</span></span><br><span class="line"><span class="undefined">            day = myDate.getDate(),</span></span><br><span class="line"><span class="undefined">            week = myDate.getDay(),</span></span><br><span class="line"><span class="javascript">            currentDays = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month + <span class="number">1</span>, <span class="number">0</span>).getDate(),</span></span><br><span class="line"><span class="javascript">            preDays = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month, <span class="number">0</span>).getDate(),</span></span><br><span class="line"><span class="javascript">            firstDay = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month, <span class="number">1</span>),</span></span><br><span class="line"><span class="undefined">            firstCell = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1,</span></span><br><span class="line"><span class="undefined">            bottomCell =  42 - currentDays - firstCell;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//前一个月该显示多少天</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> preMonth = [];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> p = firstCell; p &gt; <span class="number">0</span>; p--)&#123;</span></span><br><span class="line"><span class="javascript">            preMonth.push(<span class="keyword">new</span> <span class="built_in">Date</span>(year, month - <span class="number">1</span>, preDays - p + <span class="number">1</span>));</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> len = preMonth.length;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//本月</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> currentMonth = [];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> c = <span class="number">0</span>; c &lt; currentDays; c++)&#123;</span></span><br><span class="line"><span class="javascript">            currentMonth.push(<span class="keyword">new</span> <span class="built_in">Date</span>(year, month, c + <span class="number">1</span>));</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//下一个月</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> nextMonth = [];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> n = <span class="number">0</span>; n &lt; bottomCell; n++)&#123;</span></span><br><span class="line"><span class="javascript">            nextMonth.push(<span class="keyword">new</span> <span class="built_in">Date</span>(year, month + <span class="number">1</span>, n + <span class="number">1</span>));</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        preMonth = preMonth.concat(currentMonth, nextMonth);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="undefined">            date: preMonth,</span></span><br><span class="line"><span class="undefined">            preLen: len,</span></span><br><span class="line"><span class="undefined">            currentLen: currentMonth.length</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="javascript">    Calendar.prototype._createInputModal = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> _that = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> modalDiv = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span></span><br><span class="line"><span class="javascript">        modalDiv.id = <span class="string">'calemdar-input-modal'</span>;</span></span><br><span class="line"><span class="javascript">        modalDiv.style.display = <span class="string">'none'</span>;</span></span><br><span class="line"><span class="undefined">        modalDiv.style.zIndex = 999;</span></span><br><span class="line"><span class="javascript">        modalDiv.style.width = <span class="string">'150px'</span>;</span></span><br><span class="line"><span class="javascript">        modalDiv.style.height = <span class="string">'100px'</span>;</span></span><br><span class="line"><span class="javascript">        modalDiv.style.position = <span class="string">'absolute'</span>;</span></span><br><span class="line"><span class="javascript">        modalDiv.style.right = <span class="string">'-155px'</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> keyInput = <span class="built_in">document</span>.createElement(<span class="string">'input'</span>);</span></span><br><span class="line"><span class="javascript">        keyInput.id = <span class="string">'key-input'</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="xml">        modalDiv.innerHTML = 'key：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"calendar-key-input"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>value：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"calendar-value-input"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"calendar-sure-btn"</span>&gt;</span>确定<span class="tag">&lt;/<span class="name">button</span>&gt;</span>&amp;nbsp&amp;nbsp<span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"calendar-cancel-btn"</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">button</span>&gt;</span>';</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.div.appendChild(modalDiv);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//为确定按钮添加事件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> keyInput = <span class="built_in">document</span>.getElementById(<span class="string">'calendar-key-input'</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> valInput = <span class="built_in">document</span>.getElementById(<span class="string">'calendar-value-input'</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> surebtn = <span class="built_in">document</span>.getElementById(<span class="string">'calendar-sure-btn'</span>);</span></span><br><span class="line"><span class="javascript">        surebtn.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> key = keyInput.value;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> val = valInput.value;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(key != <span class="string">''</span> &amp;&amp; val != <span class="string">''</span>) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> id = _that._id(_that.activeDate);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span>(_that.dateInfo.id) &#123;</span></span><br><span class="line"><span class="undefined">                    _that.dateInfo.id[key] = val;</span></span><br><span class="line"><span class="javascript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="undefined">                    _that.dateInfo[id] = &#123;&#125;;</span></span><br><span class="line"><span class="undefined">                    _that.dateInfo[id][key] = val;</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="javascript">                _that[<span class="string">'showUI'</span>](<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;); <span class="comment">//重绘当前日历</span></span></span><br><span class="line"><span class="javascript">                modalDiv.style.display = <span class="string">'none'</span>;</span></span><br><span class="line"><span class="javascript">                keyInput.value = <span class="string">''</span>;</span></span><br><span class="line"><span class="javascript">                valInput.value = <span class="string">''</span>;</span></span><br><span class="line"><span class="undefined">            &#125; </span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="javascript">        <span class="comment">//为cancel按钮添加事件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> cancelbtn = <span class="built_in">document</span>.getElementById(<span class="string">'calendar-cancel-btn'</span>);</span></span><br><span class="line"><span class="javascript">        cancelbtn.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            modalDiv.style.display = <span class="string">'none'</span>;</span></span><br><span class="line"><span class="javascript">            keyInput.value = <span class="string">''</span>;</span></span><br><span class="line"><span class="javascript">            valInput.value = <span class="string">''</span>;</span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//生成一个日期id，用于存取日期信息；</span></span></span><br><span class="line"><span class="javascript">    Calendar.prototype._id = <span class="function"><span class="keyword">function</span>(<span class="params">date</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> y = date.getFullYear();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> m = date.getMonth() + <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> d = date.getDate();</span></span><br><span class="line"><span class="javascript">        m = m &lt; <span class="number">10</span> ? <span class="string">'0'</span> + m : m;</span></span><br><span class="line"><span class="javascript">        d = d &lt; <span class="number">10</span> ? <span class="string">'0'</span> + d : d;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="string">'date'</span> + y + m + d;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    Calendar.prototype._getDateInfo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">this</span>.dateInfo;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> Calendar;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">&#125;)();</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">showCalendar</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> c = <span class="keyword">new</span> Calendar(<span class="string">'calendar'</span>,&#123;</span></span><br><span class="line"><span class="javascript">            <span class="string">'date'</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(), <span class="comment">//创建日历的基本日期</span></span></span><br><span class="line"><span class="javascript">            <span class="string">'info'</span>: &#123;  <span class="comment">//日期的信息</span></span></span><br><span class="line"><span class="javascript">                <span class="string">'date20160706'</span>:&#123;<span class="string">'价格'</span>: <span class="number">100</span>, <span class="string">'数量'</span>: <span class="number">100</span>&#125;,</span></span><br><span class="line"><span class="javascript">                <span class="string">'date20160806'</span>:&#123;<span class="string">'价格'</span>: <span class="number">100</span>, <span class="string">'数量'</span>: <span class="number">100</span>&#125;</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="javascript">            <span class="string">'callback'</span>: <span class="function"><span class="keyword">function</span>(<span class="params">node,date</span>) </span>&#123; <span class="comment">//日历点击事件</span></span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> nodeClass = node.classList;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> y = date.getFullYear();</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> m = date.getMonth() + <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> d = date.getDate();</span></span><br><span class="line"><span class="javascript">                    m = m &lt; <span class="number">10</span> ? <span class="string">'0'</span> + m : m;</span></span><br><span class="line"><span class="javascript">                    d = d &lt; <span class="number">10</span> ? <span class="string">'0'</span> + d : d;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> id =  <span class="string">'date'</span> + y + m + d;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(id)</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(nodeClass)</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span>(nodeClass.contains(<span class="string">'actived-cell'</span>)) &#123;</span></span><br><span class="line"><span class="javascript">                        nodeClass.remove(<span class="string">'actived-cell'</span>)</span></span><br><span class="line"><span class="javascript">                    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                        nodeClass.add(<span class="string">'actived-cell'</span>)</span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                &#125;,</span></span><br><span class="line"><span class="javascript">            <span class="string">'scense'</span>: <span class="string">'set'</span> <span class="comment">//使用场景</span></span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="javascript">        c.getDate = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="keyword">this</span>.getAttribute(<span class="string">'date'</span>)).toLocaleString());</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="undefined">       c.showUI();</span></span><br><span class="line"><span class="undefined">   &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"showCalendar()"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"calendar"</span> <span class="attr">style</span>=<span class="string">"width:600px; height:450px;border:1px solid red;position: relative;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;由于新加入一个的公司是一个旅游公司，所以会涉及到酒店预订，但是随便搜索了一下，网上没找到适合的日历插件，而现在时间也比较多，便考虑自己实现一个，顺便提高一下自己的js水平。&lt;/p&gt;
    
    </summary>
    
      <category term="前端知识" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/"/>
    
    
      <category term="日历插件" scheme="http://yoursite.com/tags/%E6%97%A5%E5%8E%86%E6%8F%92%E4%BB%B6/"/>
    
      <category term="javascript插件" scheme="http://yoursite.com/tags/javascript%E6%8F%92%E4%BB%B6/"/>
    
      <category term="前端技能" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E8%83%BD/"/>
    
  </entry>
  
  <entry>
    <title>nodejs实现替换项目内所有文件指定字段</title>
    <link href="http://yoursite.com/2016/07/07/nodejs%E5%AE%9E%E7%8E%B0%E6%9B%BF%E6%8D%A2%E9%A1%B9%E7%9B%AE%E5%86%85%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5/"/>
    <id>http://yoursite.com/2016/07/07/nodejs实现替换项目内所有文件指定字段/</id>
    <published>2016-07-07T02:21:40.000Z</published>
    <updated>2018-06-21T02:23:57.618Z</updated>
    
    <content type="html"><![CDATA[<p>由于项目开发中项目的名称需要改变，需要将页面中出现旧名称的地方都替换成新的名称，包括一些提示语也要全部修改，想到现在需求经常改变，指不定哪天上头心血来潮就又改一次，而修改的工作肯定又落到我的头上，所以想到了写个脚本偷偷懒，提高一下效率。最近在学习nodejs，也正好熟悉一下fsapi。 <a id="more"></a><br>批量替换文件中的内容<br>====================<br>要开始一件从来没做过的事情，当然是先google一下。幸运的是找到了一个批量修改文件内URL的，正合我意，原始代买如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">arguments</span> = process.argv.slice(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">var</span> command = <span class="built_in">arguments</span>[<span class="number">0</span>]+<span class="string">""</span>;</span><br><span class="line"><span class="keyword">var</span> newReplaceUrl = <span class="built_in">arguments</span>[<span class="number">1</span>]+<span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(command != ‘-<span class="keyword">new</span>‘ || newReplaceUrl == <span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="keyword">throw</span> ‘please input your <span class="keyword">new</span> url. Eg: node rurl.js -<span class="keyword">new</span> https:<span class="comment">//www.g.cn/‘;</span></span><br><span class="line">&#125;</span><br><span class="line">       </span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(‘fs‘);</span><br><span class="line"><span class="keyword">var</span> files = [<span class="string">"bank.css"</span>, <span class="string">"wallet.css"</span>];</span><br><span class="line"><span class="keyword">var</span> URL_REG = <span class="regexp">/url\(.*?;/g</span>;</span><br><span class="line"><span class="keyword">var</span> PIC_REG = <span class="regexp">/url\(.*?(?=[A-Za-z_\-0-9]*(\.png|\.jpg))/</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;files.length;i++)&#123;</span><br><span class="line">    <span class="keyword">var</span> file = files[i];</span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params">_file</span>)</span>&#123;</span><br><span class="line">        fs.readFile(_file,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">            data = data + <span class="string">""</span>;</span><br><span class="line">            data = data.replace(URL_REG,<span class="function"><span class="keyword">function</span> (<span class="params">word</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(word.indexOf(<span class="string">"important"</span>) != <span class="number">-1</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> word;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">var</span> url = <span class="string">"url("</span> + newReplaceUrl;</span><br><span class="line">                    <span class="keyword">return</span> word.replace(PIC_REG, url);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            fs.writeFile(_file, data, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">"error!"</span> + _file);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">"success!"</span> + _file);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)(file)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>分析了一下上面这段代码，其主要功能就是从命令行接受一个命令和一个新的url，然后打开files里面的每一个文件进行替换，而我的需求是从命令行接受两个参数，一个是旧的字符串，一个是新的字符串，然后将旧的字符串替换成新的。修改后代码为:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">var</span> <span class="built_in">arguments</span> = process.argv.slice(<span class="number">2</span>); <span class="comment">//从命令行获取需要替换的字段和新字段</span></span><br><span class="line"><span class="keyword">var</span> oldstr = <span class="built_in">arguments</span>[<span class="number">0</span>]+<span class="string">""</span>;</span><br><span class="line"><span class="keyword">var</span> newstr = <span class="built_in">arguments</span>[<span class="number">1</span>]+<span class="string">""</span>;</span><br><span class="line"><span class="keyword">var</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(oldstr, <span class="string">'g'</span>); <span class="comment">//要使用变量创建正则必须使用new RegEXP()，用字面量创建不行</span></span><br><span class="line">...</span><br><span class="line">data = data.replace(reg, newstr); <span class="comment">//要全局替换的话replace里面必须使用正则，否则会只替换第一个匹配的字符串</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>这样替换函数就修改完了，保存为replace.js。<br>替换函数写完之后，我新建了一个测试文件将文件路径写到replace里面，然后运行:</p><blockquote><p>node repalce.js 测试替换 测试成功</p></blockquote><p>打开测试文件发现里面测试替换的地方都变成测试成功了，说明替换函数没有问题。</p><h1>获取所有需要修改的路径并缓存起来</h1><p>虽然替换函数写完之后，还面临着一个问题就是整个项目有几十个页面，手动添加的话肯定是不能满足我的，所以我又google了一下，nodejs如何遍历目录下所有文件，很快就找到前人写好的函数了。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>),  </span><br><span class="line">    fileList = [];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">walk</span>(<span class="params">path</span>)</span>&#123;  </span><br><span class="line">    <span class="keyword">var</span> dirList = fs.readdirSync(path);</span><br><span class="line">    dirList.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(fs.statSync(path + <span class="string">'/'</span> + item).isDirectory())&#123;</span><br><span class="line">            walk(path + <span class="string">'/'</span> + item);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            fileList.push(path + <span class="string">'/'</span> + item);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">walk(<span class="string">'/dirName'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(fileList);</span><br></pre></td></tr></table></figure><p>恩，很简单的一个递归遍历，而且正好已经把路径存好了，但是运行函数需要手动修改根目录，查看了一下nodejs的api之后，发现获取当前路径的方法如下。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path = fs.realpathSync(<span class="string">'.'</span>);</span><br></pre></td></tr></table></figure><p>至此文件路径有了，替换函数有了，基本上已经完成了。但是我只需要找到特定后缀的文件进行修改，所以在遍历文件的时候加了一个判断，当后缀为.psp的时候才将路径缓存起来。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="regexp">/\.psp$/</span>.test(item)) &#123; <span class="comment">//将所有.psp后缀的文件路径保存在fileList中</span></span><br><span class="line">    fileList.push(path + <span class="string">'/'</span> + item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将replace.js放到项目的根目录下，然后运行</p><blockquote><p>node replace.js 老字符串  新字符串</p></blockquote><p>替换成功。以后终于不用再一个一个页面去改了。<br>完整版代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> current_path = fs.realpathSync(<span class="string">'.'</span>); <span class="comment">//获取当前路径 </span></span><br><span class="line"><span class="keyword">var</span> fileList = [];</span><br><span class="line"><span class="keyword">var</span> <span class="built_in">arguments</span> = process.argv.slice(<span class="number">2</span>); <span class="comment">//从命令行获取需要替换的字段和新字段</span></span><br><span class="line"><span class="keyword">var</span> oldstr = <span class="built_in">arguments</span>[<span class="number">0</span>]+<span class="string">""</span>;</span><br><span class="line"><span class="keyword">var</span> newstr = <span class="built_in">arguments</span>[<span class="number">1</span>]+<span class="string">""</span>;</span><br><span class="line"><span class="keyword">var</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(oldstr, <span class="string">'g'</span>); <span class="comment">//新建替换正则</span></span><br><span class="line"><span class="built_in">console</span>.log(oldstr + <span class="string">'---&gt;'</span> + newstr)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(oldstr == <span class="literal">null</span> || newstr == <span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="string">'please input your oldstr and newstr: node replcae.js oldstr newstr'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//获取当前文件夹内所有指定格式的文件的绝对路径并缓存起来</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">walk</span>(<span class="params">path</span>)</span>&#123;  </span><br><span class="line">    <span class="keyword">var</span> dirList = fs.readdirSync(path);</span><br><span class="line">    dirList.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(fs.statSync(path + <span class="string">'/'</span> + item).isDirectory())&#123;</span><br><span class="line">            walk(path + <span class="string">'/'</span> + item);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="regexp">/\.psp$/</span>.test(item)) &#123; <span class="comment">//将所有.psp后缀的文件路径保存在fileList中</span></span><br><span class="line">                fileList.push(path + <span class="string">'/'</span> + item);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">walk(current_path);</span><br><span class="line"><span class="built_in">console</span>.log(fileList);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> files = fileList;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;files.length;i++)&#123;</span><br><span class="line">    <span class="keyword">var</span> file = files[i];</span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params">_file</span>)</span>&#123;</span><br><span class="line">        fs.readFile(_file,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">            data = data + <span class="string">""</span>;</span><br><span class="line">            data = data.replace(reg, newstr);</span><br><span class="line">            </span><br><span class="line">            fs.writeFile(_file, data, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">"error!"</span> + _file);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(_file + <span class="string">'   ok!'</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)(file)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>总结一下</h1><p>虽然功能是实现了，但是迫于时间，并没有深入的研究里面的逻辑，有时间还是应该重新研究一下，好好学习一下API,熟练掌握node，提高生产效率。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;由于项目开发中项目的名称需要改变，需要将页面中出现旧名称的地方都替换成新的名称，包括一些提示语也要全部修改，想到现在需求经常改变，指不定哪天上头心血来潮就又改一次，而修改的工作肯定又落到我的头上，所以想到了写个脚本偷偷懒，提高一下效率。最近在学习nodejs，也正好熟悉一下fsapi。&lt;/p&gt;
    
    </summary>
    
      <category term="前端知识" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/"/>
    
    
      <category term="nodejs" scheme="http://yoursite.com/tags/nodejs/"/>
    
      <category term="批量替换" scheme="http://yoursite.com/tags/%E6%89%B9%E9%87%8F%E6%9B%BF%E6%8D%A2/"/>
    
      <category term="文件遍历" scheme="http://yoursite.com/tags/%E6%96%87%E4%BB%B6%E9%81%8D%E5%8E%86/"/>
    
  </entry>
  
  <entry>
    <title>使用webpack打包时常用的一些插件</title>
    <link href="http://yoursite.com/2016/06/29/%E4%BD%BF%E7%94%A8webpack%E6%89%93%E5%8C%85%E6%97%B6%E5%B8%B8%E7%94%A8%E7%9A%84%E4%B8%80%E4%BA%9B%E6%8F%92%E4%BB%B6/"/>
    <id>http://yoursite.com/2016/06/29/使用webpack打包时常用的一些插件/</id>
    <published>2016-06-29T02:17:56.000Z</published>
    <updated>2018-06-21T02:24:37.953Z</updated>
    
    <content type="html"><![CDATA[<p>虽然之前已经看过很多webpack的教程，也动手写过一些小的测试用例来学习，但一直没有进行系统的记录，也没有对写过的东西进行系统化的整理，趁现在比较闲，开始整理一下webpack使用时一些通用的模块，同时构建好一个通用的开发目录，为以后开始新的项目的时候能够快速的进入开发，不必浪费时间在目录构建上面。 <a id="more"></a><br>初始化项目目录结构<br>====================<br>新建项目主文件夹然后用git对项目进行管理</p><blockquote><p>mkdir  project<br>git init</p></blockquote><h1>webpack的安装与使用</h1><p>电脑早就已经安装好了node，所以只要 npm install 一下就好了</p><blockquote><p>npm install webpack -g</p></blockquote><p>然后初始化项目结构</p><blockquote><p>npm init</p></blockquote><p>在项目主目录中新建webpack.config.js,随便在网上找了一个完整的config示例，后续进行修改以满足自己的需求。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack 配置示例</span></span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">var</span> commonsPlugin = <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(<span class="string">'common.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//插件项</span></span><br><span class="line">    plugins: [commonsPlugin],</span><br><span class="line">    <span class="comment">//页面入口文件配置</span></span><br><span class="line">    entry: &#123;</span><br><span class="line">        index : <span class="string">'./src/js/page/index.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//入口文件输出配置</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: <span class="string">'dist/js/page'</span>,</span><br><span class="line">        filename: <span class="string">'[name].js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        <span class="comment">//加载器配置</span></span><br><span class="line">        loaders: [</span><br><span class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="attr">loader</span>: <span class="string">'style-loader!css-loader'</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.js$/</span>, <span class="attr">loader</span>: <span class="string">'jsx-loader?harmony'</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.scss$/</span>, <span class="attr">loader</span>: <span class="string">'style!css!sass?sourceMap'</span>&#125;,</span><br><span class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.(png|jpg)$/</span>, <span class="attr">loader</span>: <span class="string">'url-loader?limit=8192'</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//其它解决方案配置</span></span><br><span class="line">    resolve: &#123;</span><br><span class="line">        root: <span class="string">'E:/github/flux-example/src'</span>, <span class="comment">//绝对路径</span></span><br><span class="line">        extensions: [<span class="string">''</span>, <span class="string">'.js'</span>, <span class="string">'.json'</span>, <span class="string">'.scss'</span>],</span><br><span class="line">        alias: &#123;</span><br><span class="line">            AppStore : <span class="string">'js/stores/AppStores.js'</span>,</span><br><span class="line">            ActionType : <span class="string">'js/actions/ActionType.js'</span>,</span><br><span class="line">            AppAction : <span class="string">'js/actions/AppAction.js'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol><li>plugins 是插件项，这里我们使用了一个 CommonsChunkPlugin 的插件，它用于提取多个入口文件的公共脚本部分，然后生成一个 common.js 来方便多页面之间进行复用。</li><li>entry 是页面入口文件配置，output 是对应输出项配置（即入口文件最终要生成什么名字的文件、存放到哪里）</li><li>module.loaders 是最关键的一块配置。它告知 webpack 每一种文件都需要使用什么加载器来处理</li><li>最后是 resolve 配置<br>安装插件<br>=============<br>配置html-webpack-plugin<br>==========================</li></ol><p>html-webpack-plugin可以自动快速的生成html文件，就不用每次还得手动重复的去建立html文件了。<br>安装</p><blockquote><p>npm install html-webpack-plugin --save-dev</p></blockquote><p>然后修改config</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlwebpackPlugin(&#123;</span><br><span class="line">      title: <span class="string">''</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h1>配置webpack-dev-server</h1><p>webpack-dev-server可以建立一个sever，监控文件的变化，实现页面自动刷新，所以开发的时候不需要手动刷新便可以看到改动的效果。<br>安装</p><blockquote><p>npm install webpack-dev-server --save-dev</p></blockquote><p>然后修改config进行配置</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> module.exports = &#123;</span><br><span class="line">  ....</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    historyApiFallback: true,</span><br><span class="line">    hot: true,</span><br><span class="line">    inline: true,</span><br><span class="line">    progress: true,</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后再package.json里面配置一下运行的命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;start&quot;: &quot;webpack-dev-server --hot --inline&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>在项目根目录下输入</p><blockquote><p>npm start</p></blockquote><p>就可以启动sever，在浏览器中打开localhost:8080就可以看到页面，接下来只要修改文件页面就会自动刷新了。<br>配置loaders<br>===========<br>css,scss<br>========<br>处理css需要两种loader，css-loader 和 style-loader，css-loader会遍历css文件，找到所有的url(…)并且处理。style-loader会把所有的样式插入页面的一个style tag中。.scss 文件使用 style-loader、css-loader 和 sass-loader 来编译处理。<br>安装</p><blockquote><p>npm install css-loader style-loader sass-loader --save-dev</p></blockquote><h1>es6和jsx</h1><p>es6的语法支持和jsx文件可以通过bable进行编译处理<br>安装</p><blockquote><p>npm install babel-loader babel-preset-es2015 --save-dev</p></blockquote><h1>处理图片和其他静态文件</h1><p>url-loader可以处理静态资源，根据需求将图片自动转成base64编码的，可以减轻很多的网络请求。<br>安装</p><blockquote><p>npm install url-loader --save-dev</p></blockquote><p>最终config文件中的module.loader配置是这样的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">module: &#123;</span><br><span class="line">    loaders: [</span><br><span class="line">            //.css 文件使用 style-loader 和 css-loader 来处理</span><br><span class="line">            &#123; test: /\.css$/, loader: &apos;style-loader!css-loader&apos; &#125;,</span><br><span class="line">            //.js 文件使用 jsx-loader 来编译处理</span><br><span class="line">            &#123; test: /\.jsx?$/, loader: &apos;babel&apos;,include: APP_PATH, query: &#123; presets: [&apos;es2015&apos;] &#125; &#125;,</span><br><span class="line">            //.scss 文件使用 style-loader、css-loader 和 sass-loader 来编译处理</span><br><span class="line">            &#123; test: /\.scss$/, loader: &apos;style!css!sass?sourceMap&apos;&#125;,</span><br><span class="line">            //图片文件使用 url-loader 来处理，小于8kb的直接转为base64</span><br><span class="line">            &#123; test: /\.(png|jpg)$/, loader: &apos;url-loader?limit=8192&apos;&#125;</span><br><span class="line">        ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><h1>独立打包css</h1><p>希望项目的样式能不要被打包到脚本中，而是独立出来作为.css，然后在页面中以<link>标签引入。这时候可以使用 extract-text-webpack-plugin</p><blockquote><p>npm install extract-text-webpack-plugin --save-dev</p></blockquote><p>在config中设置一下插件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var webpack = require(&apos;webpack&apos;);</span><br><span class="line">    var commonsPlugin = new webpack.optimize.CommonsChunkPlugin(&apos;common.js&apos;);</span><br><span class="line">    var ExtractTextPlugin = require(&quot;extract-text-webpack-plugin&quot;);</span><br><span class="line"></span><br><span class="line">    module.exports = &#123;</span><br><span class="line">        plugins: [commonsPlugin, new ExtractTextPlugin(&quot;[name].css&quot;)],</span><br><span class="line">        entry: &#123;</span><br><span class="line">        //...省略其它配置</span><br></pre></td></tr></table></figure><p>大致是完成了，接下来应该会学习一些插件的更多用法</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;虽然之前已经看过很多webpack的教程，也动手写过一些小的测试用例来学习，但一直没有进行系统的记录，也没有对写过的东西进行系统化的整理，趁现在比较闲，开始整理一下webpack使用时一些通用的模块，同时构建好一个通用的开发目录，为以后开始新的项目的时候能够快速的进入开发，不必浪费时间在目录构建上面。&lt;/p&gt;
    
    </summary>
    
      <category term="前端知识" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/"/>
    
    
      <category term="前端知识" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/"/>
    
      <category term="webpack" scheme="http://yoursite.com/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>第一篇文章</title>
    <link href="http://yoursite.com/2016/06/27/%E7%AC%AC%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0/"/>
    <id>http://yoursite.com/2016/06/27/第一篇文章/</id>
    <published>2016-06-27T12:01:11.000Z</published>
    <updated>2016-06-28T07:18:22.469Z</updated>
    
    <content type="html"><![CDATA[<p>*第一次想要搭建一个blog不知道是几年之前了，自己搞过服务器用webpy搭建过一个简易的，也在csdn开通过，但都只是三分钟热度，并没有在上面发表过什么东西，肚子里没几滴墨水，大学几年也浑浑噩噩，没学到什么东西。<br>*github也注册很久了，然而现在前端水平也只属于入门水平，并没有什么满意的项目推送到仓库。之前也有弄了一下gitpage，但是感觉并不方便，写博客的计划就又搁置了。知道最近发现hexo，而现在更换上班地点后到家比较早了，便又开始试了一下，作为一个前端，在发现页面主题和颜色可以自己编写之后又便根本停不下来了，折腾了半天之后，终于成了现在这个样子，虽然还需继续完善，但勉强也能看得下去了。<br>*毕业两年，作为前端工作也快满一年了，也逐渐开始深入学习，学习过程就在此记录吧。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;*第一次想要搭建一个blog不知道是几年之前了，自己搞过服务器用webpy搭建过一个简易的，也在csdn开通过，但都只是三分钟热度，并没有在上面发表过什么东西，肚子里没几滴墨水，大学几年也浑浑噩噩，没学到什么东西。&lt;br&gt;
*github也注册很久了，然而现在前端水平也只属
      
    
    </summary>
    
      <category term="随笔" scheme="http://yoursite.com/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="随笔" scheme="http://yoursite.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
</feed>
